# Dragon Warrior IV - Mesen Debug Labels
# Format: ADDR:LABEL:COMMENT
# Created for Mesen NES emulator/debugger

# ==============================================================================
# ZERO PAGE ($00-$FF) - System Variables
# ==============================================================================
P:0010:ptr_lo:General purpose pointer low byte
P:0011:ptr_hi:General purpose pointer high byte
P:0012:rng_seed_lo:RNG seed low byte - changes every frame, XORed with save checksum
P:0013:rng_seed_hi:RNG seed high byte - acts like DW3's RNG
P:0014:scroll_temp:Scroll temporary
P:0016:rng_temp:RNG temporary storage - used during RNG calculation
P:0018:encounter_rate:Encounter rate of current tile
P:001F:state_flags:System state flags (bit 7 = busy)
P:0020:reg_save_a:Saved A during IRQ
P:0021:reg_save_x:Saved X during IRQ
P:0022:reg_save_y:Saved Y during IRQ
P:0023:irq_param_1:IRQ dispatch parameter 1
P:0024:irq_param_2:IRQ dispatch parameter 2
P:0026:brk_ptr_lo:Pointer to BRK operand low
P:0027:brk_ptr_hi:Pointer to BRK operand high
P:0039:ppu_ctrl_mirror:PPU control mirror
P:0040:temp_40:Temporary variable
P:0063:MapNumber:Current map number
P:0064:SubmapNumber:Current submap number
P:0076:irq_temp_76:IRQ temporary
P:0077:irq_temp_77:IRQ temporary
P:0078:irq_temp_78:IRQ temporary
P:007B:scroll_x:Scroll X position
P:007C:scroll_y:Scroll Y position
P:007F:scroll_counter:Scroll counter
P:00EA:position_x_lo:Player X position low byte
P:00EB:position_x_hi:Player X position high byte
P:00EC:position_y_lo:Player Y position low byte
P:00ED:position_y_hi:Player Y position high byte

# ==============================================================================
# WORK RAM ($0100-$07FF)
# ==============================================================================
R:0200:oam_buffer:OAM DMA buffer (256 bytes)
R:0300:ppu_buffer:PPU update buffer
R:0500:vblank_flag:VBlank synchronization flag
R:0501:ppuctrl_shadow:Shadow of PPUCTRL ($2000)
R:0502:NMI_JMP:JMP opcode for NMI vector
R:0503:NMI_target_lo:NMI target address low byte
R:0504:NMI_target_hi:NMI target address high byte
R:0505:ppuctrl_extra:Additional PPU control
R:0506:ppumask_shadow:Shadow of PPUMASK ($2001)
R:0507:current_bank:Currently selected PRG bank
R:0508:scroll_x_shadow:Scroll X shadow
R:0509:scroll_y_shadow:Scroll Y shadow
R:050A:ppu_temp_a:PPU temporary A
R:050B:ppu_buffer_count:PPU buffer entry count
R:050C:rng_counter_cmp:RNG counter comparison value
R:050D:rng_counter:RNG counter - increments each time random number generated
R:0513:shuffle_index:OAM shuffle index
R:0519:nmi_skip_flag:NMI skip update flag
R:0526:timer_counter:Timer counter (CBB4 adds 8 each frame)
R:0529:controller_state:Controller button state
R:052E:input_delay:Input delay counter
R:058F:movement_speed:Movement speed/delta
R:05FC:palette_color:Palette color value
R:07CA:bank_call_result:Bank call result storage
R:07CC:bank_call_save:Bank call saved bank

# ==============================================================================
# SRAM/WRAM ($6000-$7FFF) - Save Game Data (Battery-Backed)
# ==============================================================================

# Save File Layout (from cowness.net)
# Current Save: $6000-$62EE (751 bytes)
# File 1:       $62EF-$65DE (752 bytes)
# File 2:       $65DF-$68CE (752 bytes)
# File 3:       $68CF-$6BBE (752 bytes)

# General Save Data Header
G:6000:SaveDataStart:Start of SRAM save data

# Party Member 0 (Hero) - 30 bytes
G:6001:Party0_Start:Hero - Party slot 0 start
G:6001:Party0_StatusFlags:Hero - Status effect flags (poison, curse, etc)
G:6002:Party0_CurrentHP_Lo:Hero - Current HP (low byte)
G:6003:Party0_CurrentHP_Hi:Hero - Current HP (high byte)
G:6004:Party0_MaxHP_Lo:Hero - Max HP (low byte)
G:6005:Party0_MaxHP_Hi:Hero - Max HP (high byte)
G:6006:Party0_CurrentMP:Hero - Current MP
G:6007:Party0_MaxMP:Hero - Max MP
G:6008:Party0_Level:Hero - Level
G:6009:Party0_Strength:Hero - Strength stat
G:600A:Party0_Agility:Hero - Agility stat
G:600B:Party0_Vitality:Hero - Vitality stat
G:600C:Party0_Intelligence:Hero - Intelligence stat
G:600D:Party0_Luck:Hero - Luck stat
G:600E:Party0_Attack:Hero - Attack power
G:600F:Party0_Defense:Hero - Defense power
G:6010:Party0_Item0:Hero - Item slot 0 (high bit = equipped)
G:6011:Party0_Item1:Hero - Item slot 1
G:6012:Party0_Item2:Hero - Item slot 2
G:6013:Party0_Item3:Hero - Item slot 3
G:6014:Party0_Item4:Hero - Item slot 4
G:6015:Party0_Item5:Hero - Item slot 5
G:6016:Party0_Item6:Hero - Item slot 6
G:6017:Party0_Item7:Hero - Item slot 7
G:6018:Party0_SpellFlags_Lo:Hero - Learned spells (low byte)
G:6019:Party0_SpellFlags_Hi:Hero - Learned spells (high byte)
G:601A:Party0_EXP_Lo:Hero - Experience (low byte)
G:601B:Party0_EXP_Mid:Hero - Experience (middle byte)
G:601C:Party0_EXP_Hi:Hero - Experience (high byte)

# Party Member 1 (Cristo) - 30 bytes
G:601F:Party1_Start:Cristo - Party slot 1 start
G:601F:Party1_StatusFlags:Cristo - Status effect flags
G:6020:Party1_CurrentHP_Lo:Cristo - Current HP (low byte)
G:6021:Party1_CurrentHP_Hi:Cristo - Current HP (high byte)
G:6022:Party1_MaxHP_Lo:Cristo - Max HP (low byte)
G:6023:Party1_MaxHP_Hi:Cristo - Max HP (high byte)
G:6024:Party1_CurrentMP:Cristo - Current MP
G:6025:Party1_MaxMP:Cristo - Max MP
G:6026:Party1_Level:Cristo - Level

# Party Member 2 (Nara) - 30 bytes
G:603D:Party2_Start:Nara - Party slot 2 start

# Party Member 3 (Mara) - 30 bytes
G:605B:Party3_Start:Mara - Party slot 3 start

# Party Member 4 (Brey) - 30 bytes
G:6079:Party4_Start:Brey - Party slot 4 start

# Party Member 5 (Taloon) - 30 bytes
G:6097:Party5_Start:Taloon - Party slot 5 start

# Party Member 6 (Ragnar) - 30 bytes
G:60B5:Party6_Start:Ragnar - Party slot 6 start

# Party Member 7 (Alena) - 30 bytes
G:60D3:Party7_Start:Alena - Party slot 7 start

# General Save Memory ($6157-$62EE)
G:6157:Gold_Lo:Gold amount (low byte)
G:6158:Gold_Mid:Gold amount (middle byte)
G:6159:Gold_Hi:Gold amount (high byte)
G:615A:ChapterNumber:Current chapter (0=Ch1, 1=Ch2, 2=Ch3, 3=Ch4, 4=Ch5)
G:615B:BattleTactics:AI tactics (0=Normal, 1=SaveMP, 2=Offensive, 3=Defensive, 4=TryOut, 5=UseNoMP)

# Return Spell Locations
G:6165:ReturnLoc1:Return spell destination 1
G:6166:ReturnLoc2:Return spell destination 2
G:6167:ReturnLoc3:Return spell destination 3

# Treasure Chest Flags (27 bytes)
G:625D:TreasureFlags_Start:Treasure chest bit flags start
G:625E:TreasureFlags_01:Treasure flags byte 1
G:625F:TreasureFlags_02:Treasure flags byte 2
G:6260:TreasureFlags_03:Treasure flags byte 3
G:6261:TreasureFlags_04:Treasure flags byte 4
G:6262:TreasureFlags_05:Treasure flags byte 5
G:6263:TreasureFlags_06:Treasure flags byte 6
G:6264:TreasureFlags_07:Treasure flags byte 7
G:6265:TreasureFlags_08:Treasure flags byte 8
G:6266:TreasureFlags_09:Treasure flags byte 9
G:6267:TreasureFlags_0A:Treasure flags byte 10
G:6268:TreasureFlags_0B:Treasure flags byte 11
G:6269:TreasureFlags_0C:Treasure flags byte 12
G:626A:TreasureFlags_0D:Treasure flags byte 13
G:626B:TreasureFlags_0E:Treasure flags byte 14
G:626C:TreasureFlags_0F:Treasure flags byte 15
G:626D:TreasureFlags_10:Treasure flags byte 16
G:626E:TreasureFlags_11:Treasure flags byte 17
G:626F:TreasureFlags_12:Treasure flags byte 18
G:6270:TreasureFlags_13:Treasure flags byte 19
G:6271:TreasureFlags_14:Treasure flags byte 20
G:6272:TreasureFlags_15:Treasure flags byte 21
G:6273:TreasureFlags_16:Treasure flags byte 22
G:6274:TreasureFlags_17:Treasure flags byte 23
G:6275:TreasureFlags_18:Treasure flags byte 24
G:6276:TreasureFlags_19:Treasure flags byte 25
G:6277:TreasureFlags_1A:Treasure flags byte 26

# Casino Coins
G:62AD:CasinoCoins_Lo:Casino coins (low byte)
G:62AE:CasinoCoins_Mid:Casino coins (middle byte)
G:62AF:CasinoCoins_Hi:Casino coins (high byte)

# Day/Night Cycle
G:62ED:DayNightCounter:Day/night cycle counter ($00-$CB)

# Bag Storage
G:62EF:BagStorage_Start:Bag item storage start

# ==============================================================================
# BATTLE SYSTEM RAM ($6E00-$6E80) - Bank 19 Battle Calculations
# ==============================================================================
G:6E11:battle_div_rem_lo:Division remainder low byte
G:6E12:battle_div_rem_mid:Division remainder mid byte
G:6E13:battle_div_rem_hi:Division remainder high byte
G:6E14:battle_div_divisor_lo:Division divisor low byte
G:6E15:battle_div_divisor_mid:Division divisor mid byte
G:6E16:battle_div_divisor_hi:Division divisor high byte
G:6E44:battle_flag:Battle mode flag
G:6E80:battle_state:Current battle action/state

# ==============================================================================
# BATTLE SYSTEM RAM ($7500-$7600) - Party Stats Buffer
# ==============================================================================
G:7591:party_stat_buffer:Party stat calculation buffer (4 entries)
G:7595:party_stat_buffer_2:Party stat calculation buffer 2 (4 entries)
G:75AD:battle_stat_ad:Battle stat AD
G:75AE:battle_stat_ae:Battle stat AE
G:75AF:battle_stat_af:Battle stat AF
G:75B0:battle_stat_b0:Battle stat B0
G:75B1:battle_stat_b1:Battle stat B1
G:75B2:battle_stat_b2:Battle stat B2
G:75B3:battle_stat_b3:Battle stat B3
G:75B4:battle_stat_b4:Battle stat B4
G:75B5:battle_stat_b5:Battle stat B5
G:75B6:battle_stat_b6:Battle stat B6
G:75B7:battle_stat_b7:Battle stat B7
G:75B8:battle_stat_b8:Battle stat B8
G:75B9:battle_stat_b9:Battle stat B9
G:75BA:battle_stat_ba:Battle stat BA
G:75BB:battle_stat_bb:Battle stat BB
G:75BC:battle_stat_bc:Battle stat BC
G:75BD:battle_stat_bd:Battle stat BD
G:75BE:battle_stat_be:Battle stat BE
G:75BF:battle_stat_bf:Battle stat BF
G:75C0:battle_stat_c0:Battle stat C0
G:75D4:battle_var_d4:Battle variable D4
G:75D5:battle_var_d5:Battle variable D5
G:75D7:battle_var_d7:Battle variable D7
G:75D8:battle_var_d8:Battle variable D8
G:75D9:battle_var_d9:Battle variable D9
G:75DA:battle_var_da:Battle variable DA
G:75DB:battle_var_db:Battle variable DB (init to $FF)
G:75DC:battle_special_flag:Battle special flag ($FF if $73 set)
G:75E6:battle_var_e6:Battle variable E6
G:75E7:battle_var_e7:Battle variable E7
G:75E8:battle_action_index:Battle action index (0-7 valid)

# ==============================================================================
# CHARACTER STATE ARRAY ($72F4+)
# ==============================================================================
G:72F4:char_state_array:Character state array (indexed by X)
G:7004:char_flags_array:Character flags array (indexed by X)
G:7024:battle_result_24:Battle result byte 24
G:7025:battle_result_25:Battle result byte 25

# ==============================================================================
# PRG ROM Banks - Map Data (Bank $09)
# ==============================================================================
R:30010:Bank09_Start:Bank 9 start - Map data

# Keeleon
R:30000:Map00_Keeleon_Outside:Keeleon - Outside
R:30085:Map00_Keeleon_F1:Keeleon - F1
R:3012B:Map00_Keeleon_F2:Keeleon - F2
R:301AE:Map00_Keeleon_F3:Keeleon - F3
R:301C1:Map00_Keeleon_B1:Keeleon - B1, Jail

# Santeem
R:30206:Map01_Santeem_F1:Santeem - F1
R:302DD:Map01_Santeem_F2:Santeem - F2
R:30344:Map01_Santeem_F3:Santeem - F3

# Burland
R:30398:Map02_Burland:Burland
R:3050C:Map02_Burland_Castle_F1:Burland - Castle, F1
R:305DE:Map02_Burland_Castle_F2:Burland - Castle, F2
R:3065D:Map02_Burland_Flora:Burland - Flora's House / Armor Shop, F2

# Dire Palace
R:3069B:Map03_DirePalace_F1:Dire Palace - F1
R:307B5:Map03_DirePalace_F2:Dire Palace - F2
R:30834:Map03_DirePalace_B1_Kitchen:Dire Palace - B1, Kitchen/Jail
R:308CF:Map03_DirePalace_B1_Tomb:Dire Palace - B1, Tomb

# Endor
R:308E7:Map04_Endor:Endor
R:30A45:Map04_Endor_Casino:Endor - Casino/Monster Arena
R:30AAB:Map04_Endor_Castle_F1:Endor - Castle, F1
R:30C77:Map04_Endor_Arena:Endor - Back Castle, Arena

# ==============================================================================
# PRG ROM Banks - Text Data (Banks $0C-$0E typically)
# ==============================================================================

# ==============================================================================
# CHR ROM - Graphics Data
# ==============================================================================

# ==============================================================================
# Hardware Registers
# ==============================================================================
R:2000:PPUCTRL:PPU Control Register
R:2001:PPUMASK:PPU Mask Register
R:2002:PPUSTATUS:PPU Status Register
R:2003:OAMADDR:OAM Address Register
R:2004:OAMDATA:OAM Data Register
R:2005:PPUSCROLL:PPU Scroll Register
R:2006:PPUADDR:PPU Address Register
R:2007:PPUDATA:PPU Data Register
R:4014:OAMDMA:OAM DMA Register
R:4015:SND_CHN:APU Sound Channel Enable
R:4016:JOYPAD1:Joypad 1 Register
R:4017:JOYPAD2:Joypad 2 / APU Frame Counter

# ==============================================================================
# PRG ROM - Fixed Bank Code ($C000-$FFFF)
# ==============================================================================

# Main Initialization
R:C03D:main_init:Main initialization routine
R:C03E:vblank_wait_1:Wait for first VBlank
R:C043:vblank_wait_2:Wait for second VBlank
R:C067:setup_nmi_vector:Set up NMI JMP in RAM
R:C07E:clear_ram_loop:Clear zero page and RAM

# Bank Switching Routines
R:C104:init_subroutine:Additional initialization
R:C118:mmc1_write_control:Write to MMC1 Control register ($9FFF)
R:C12F:mmc1_write_chr1:Write to MMC1 CHR Bank 1 ($BFFF)
R:C146:mmc1_write_prg:Write to MMC1 PRG Bank ($DFFF)

# NMI Handler
R:C15A:NMI_main:NMI handler entry point
R:C181:NMI_check_stack:Check return address on stack
R:C1EF:NMI_update_frame:Update frame counter
R:C213:NMI_return:Normal NMI return
R:C219:NMI_to_irq:Jump to IRQ handler

# PPU Update Routines
R:C222:ppu_buffer_transfer:Transfer PPU update buffer to VRAM
R:C241:ppu_write_loop:PPU buffer write loop
R:C267:ppu_write_data:Write data to PPUDATA
R:C276:ppu_update_palette:Update palette if needed
R:C297:ppu_update_tiles:Update tile data
R:C2EA:ppu_set_scroll:Set PPU scroll registers
R:C303:oam_dma:Perform OAM DMA transfer

# IRQ Handler
R:C408:IRQ_handler:IRQ/BRK handler entry
R:C423:irq_read_operand:Read BRK operand byte
R:C460:irq_dispatch_03:Dispatch for operand ending in $03
R:C463:irq_dispatch_0B:Dispatch for operand ending in $0B
R:C4CA:irq_set_flag:Set flag in $627B table
R:C4E1:irq_clear_flag:Clear flag in $627B table
R:C4F8:irq_extended:Extended opcode handler

# System Utilities
R:C52F:clear_system_state:Clear system state variables
R:C543:clear_oam_buffer:Clear OAM buffer to $F7

# Main Game Loop
R:C890:rng_return:RNG RTS
R:C891:rng_main:Main RNG function - generates random number
R:C8A1:rng_inc_counter:Increment RNG counter at $050D
R:C8A6:rng_load_seed:Load seed from $0012 and add counter
R:C8AD:rng_shifter:RNG bit shift subroutine
R:C8CB:rng_shifter_end:RNG shifter end
R:C913:rng_related:RNG related subroutine (called from NMI)
R:C968:main_loop_entry:Main game loop entry point
R:C97D:main_loop:Main game loop (infinite)
R:C983:setup_bank_trampoline:Copy bank switch code to SRAM
R:C9ED:main_frame_handler:Main frame processing handler

# Frame Handler Subroutines
R:CA21:sub_CA21:Unknown processing
R:CB98:read_controller:Read controller input via $4016
R:CBB4:timer_update:Update timer counter ($0526 += 8)
R:D542:map_handler:Map/scroll position handler
R:E06E:movement_update:Update player position based on direction

# High ROM Utilities
R:FF00:utility_area:Utility code area
R:FF74:nmi_rng_update:NMI handler - updates RNG seed $0012
R:FF79:nmi_inc_seed:Increment RNG seed low byte
R:FF82:nmi_call_rng:Call RNG-related subroutine
R:FF8E:jump_main_init:Jump to main_init
R:FF91:bank_switch:Bank switch routine

# Reset Handler
R:FFD8:RESET_entry:RESET vector entry point
R:FFDF:mmc1_reset_trigger:MMC1 reset trigger byte

# CPU Vectors
R:FFFA:vec_NMI:NMI Vector ($0502)
R:FFFC:vec_RESET:RESET Vector ($FFD8)
R:FFFE:vec_IRQ:IRQ Vector ($C408)

# ==============================================================================
# PRG ROM - Bank 19 Battle System Code ($8000-$BFFF when loaded)
# Note: These are CPU addresses when bank 19 is in $8000-$BFFF slot
# ROM address = CPU address + $4C010 - $8000 = CPU address + $44010
# ==============================================================================

# Bank 19 Entry Points and Main Functions
R:8038:b19_battle_entry:Bank 19 battle entry point
R:804A:b19_battle_setup:Battle setup (calls 8051, 845A)
R:8051:b19_init_vars:Initialize battle variables (BRK segment)
R:805B:b19_dispatch_action:Dispatch action via jump table at $8078
R:8074:b19_action_nop:Action 0 - No action (RTS)
R:8075:b19_mode_4_jump:Mode 4 jump to $A8C6
R:8078:b19_action_table:Jump table for 8 battle actions (16 bytes)
R:8088:b19_read_tactics:Read $615B (tactics) into $6E80
R:80A1:b19_check_char_state:Check character state via $72F4,X
R:80FA:b19_clear_battle_vars:Clear $75D4-$75E7 battle variables

# Bank 19 16-bit Math Functions
R:8176:b19_mul16:16-bit left shift x4 (multiply by 16)
R:8187:b19_div16:16-bit right shift x4 (divide by 16)
R:8198:b19_scale_stat:Scale stat value by A register
R:81A5:b19_shift_ext:4-bit shift with extended precision in $19
R:8330:b19_mult_by_a:Multiply X register pair by A (stat calc)
R:8366:b19_mult_pair:Multiply pair at X by A register
R:83AA:b19_add_pairs:Add two 16-bit pairs at X and Y

# Bank 19 Division Routines
R:83C5:b19_div_16_loop:16-bit division loop (shift-subtract method)
R:83F4:b19_div_24_setup:24-bit division setup (sets up divisor)
R:8414:b19_div_24_loop:24-bit division loop
R:8454:b19_div_3byte:3-byte division helper

# Bank 19 Battle Core
R:845A:b19_battle_calc:Battle calculation wrapper (contains BRK)
R:8488:b19_unknown_8488:Unknown battle helper
R:89B6:b19_get_action_data:Get action data pointer into $79
R:89F5:b19_get_action_2:Get secondary action data
R:8A05:b19_calc_target:Calculate target selection

# Bank 19 Character Data Access
R:8D77:b19_setup_char_ptr:Set up character data pointer at $88-$89

# Bank 19 Hit/Miss and Damage
R:9110:b19_finalize_action:Finalize action (JMP target from handlers)
R:9135:b19_check_hit:Hit/miss check - compare $75DB against thresholds
R:919A:b19_hit_6:Hit check for action type < $29 (returns CMP #6)
R:91A0:b19_clear_damage:Clear $75D4-$75D5 (damage output?)
R:91A9:b19_action_codes:Action code table for special handling
R:91CD:b19_action_jmptbl:Jump table for special action handlers

# Bank 19 Party Stat Summation
R:9201:b19_get_enemy_idx:Get enemy index from $75D3 into $8B
R:9212:b19_sum_party_stats:Sum all 8 party members' stats (main calc)
R:921C:b19_party_loop:Party stat sum loop (8 iterations)
R:925F:b19_add_stat_pair:Add stat pair from ($88)+Y to tmp1-tmp2
R:9276:b19_stat_table_lookup:Look up stat in table at $B80B
R:9584:b19_setup_action:Set up action execution

# Bank 19 Action Dispatchers
R:A54D:b19_exec_action_step:Execute one action step (uses table at $A626)
R:A58D:b19_validate_action:Validate action step
R:A5AA:b19_find_target:Find valid target for action
R:A5FC:b19_check_execute:Check if action can execute
R:A61A:b19_calc_offset:Calculate offset = C * 12 (for action tables)
R:A624:b19_action_ptr_table:Pointer table for action types (8 entries)

# Bank 19 Battle State Management
R:A6C6:b19_state_setup_1:Battle state setup function 1
R:A6CA:b19_state_setup_2:Battle state setup function 2
R:A6CE:b19_state_setup_3:Battle state setup function 3
R:A6D2:b19_state_cleanup:Battle state cleanup

# Bank 19 Damage Calculation
R:AA54:b19_store_action:Store action type to $75DA
R:AA67:b19_damage_calc:Main damage calculation routine
R:AA9F:b19_apply_defense:Apply defense modifier
R:AB59:b19_check_resist:Check resistance/elemental effectiveness

# Bank 19 Action Handlers (Jump table targets from $8078)
R:AF10:b19_action_1_handler:Action 1 handler - Attack sequence
R:AF48:b19_action_4_handler:Action 4 handler - Skill/Spell
R:AF97:b19_action_2_handler:Action 2 handler - Item use
R:AFF0:b19_action_ff0:Action handler at AFF0
R:B049:b19_action_5_handler:Action 5-7 handler - Defense/Other

# Bank 19 Special Checks
R:B066:b19_chapter_check:Check if chapter == 4 ($615A)
R:B08C:b19_party_status_check:Check party member status
R:B0B4:b19_bit_rotate:Bit rotation helper
R:B0E0:b19_special_enemy:Special enemy check ($75DB == $43)
R:B132:b19_find_valid_char:Find valid character in party

# Bank 19 Data Tables
R:B74D:b19_stat_table_1:Stat modifier table 1
R:B803:b19_unknown_table:Unknown table at B803
R:B80B:b19_spell_effect_table:Spell/action effect type table (256 bytes)
R:B915:b19_spell_param_1:Spell parameter table 1
R:B949:b19_spell_param_2:Spell parameter table 2
R:B967:b19_enemy_data:Enemy resistance/type data table (256 bytes)
R:BA4E:b19_ai_table_1:AI decision table 1
R:BA6C:b19_ai_table_2:AI table 2 (4 bytes)
R:BA70:b19_ai_table_3:AI table 3 (4 bytes)
R:BA74:b19_tactics_spell_1:Tactics spell data table 1 (7*7=49 bytes)
R:BAA5:b19_tactics_spell_2:Tactics spell data table 2 (48 bytes)
R:BAD5:b19_tactics_spell_3:Tactics spell data table 3 (18 bytes)
R:BB06:b19_tactics_modifier:Tactics-based spell modifiers
R:BB22:b19_spell_bonus:Spell bonus values by tactics
R:BB3F:b19_spell_power:Spell power table (9 entries)
R:BB49:b19_spell_attribute:Spell attribute table (9 entries)
R:BB84:b19_mode_mult_table:Attack multiplier by tactics (7 entries)
R:BB8B:b19_mode_divisor:Stat multiplier by tactics (7 entries)
R:BB92:b19_hit_threshold:Hit threshold table by mode (7 entries)
R:BB99:b19_base_value:Base damage value (64)

# ==============================================================================
# Bank 19 Battle RAM Variables (Additional)
# ==============================================================================
G:75D1:battle_action_ptr:Current action pointer low
G:75D2:battle_action_type:Current action type
G:75D3:battle_target_idx:Target index (enemy or char)
G:75D9:battle_actor_idx:Acting character/enemy index
G:75DA:battle_action_cat:Action category (upper nibble)
G:75DB:battle_action_id:Action ID for hit calculation
G:75E1:battle_power_lo:Action power low byte
G:75E2:battle_power_hi:Action power high byte
G:75E5:battle_temp_e5:Temp storage E5
G:75EC:battle_rng_value:RNG value for hit check
G:75ED:battle_stat_sum_lo:Sum of party stats low byte
G:75EE:battle_stat_sum_hi:Sum of party stats high byte
G:75EF:battle_defense_mod:Defense modifier value
G:75F0:battle_flag_f0:Battle flag F0 (bit 7 cleared by dispatcher)
G:75F2:battle_special:Special battle value ($7355)

# ==============================================================================
# Bank 19 Zero Page (during battle)
# ==============================================================================
P:0079:action_data_ptr_lo:Pointer to action data (low byte)
P:007A:action_data_ptr_hi:Pointer to action data (high byte)
P:007B:calculated_hit:Calculated hit value
P:0081:party_loop_counter:Party member loop counter (7 down to 0)
P:0082:inner_loop_counter:Inner loop counter
P:0086:stat_ptr_lo:Stat table pointer low
P:0087:stat_ptr_hi:Stat table pointer high
P:0088:char_data_ptr_lo:Character data pointer low
P:0089:char_data_ptr_hi:Character data pointer high
P:008A:char_count:Character count
P:008B:actor_index:Current actor index
P:008C:action_param:Action parameter
P:0093:battle_flags:Battle calculation flags (LSR'd for tests)
P:0096:active_char_idx:Active character index for $72F4

# ==============================================================================
# Bank 19 Spell Subroutines
# ==============================================================================
R:9365:b19_get_tactics_spell_1:Get tactics spell data from $BAA5 (via sub_938B)
R:937A:b19_get_tactics_spell_2:Get tactics spell data from $BAD5 (via sub_938B)
R:938B:b19_calc_tactics_index:Calculate tactics spell index (tactics*7 + $75E8)
R:939A:b19_get_tactics_spell_3:Get tactics spell data from $BA74 (via sub_938B)
R:AEA6:b19_get_spell_power:Get spell power from $BB3F[X] (cap at 8)
R:AEAF:b19_shift_right_8c8b:Shift $8C:$8B right one bit
R:AEB4:b19_get_spell_attr:Get spell attribute from $BB49[X] (cap at 8)
R:AEC0:b19_cap_spell_index:Cap $75E8 at 8 for table lookup

# ==============================================================================
# Bank 19 Spell/Battle RAM (Additional)
# ==============================================================================
G:75E8:spell_level_index:Spell level/slot index (0-7, capped at 8)
G:6E11:spell_lookup_result:Spell table lookup result storage

# ==============================================================================
# BATTLE STATE RAM ($615A-$61FF) - Identified via Code Analysis
# ==============================================================================
# Most heavily accessed battle variables discovered through ROM analysis
G:615A:battle_actor_index:Current battle actor index (98 accesses in ROM)
G:618E:battle_state_flags:Battle state flags (65 accesses - reads/writes)
G:616A:battle_action_data:Battle action data array (indexed access - 59 uses)
G:6018:battle_status_counter:Battle status or counter (30 accesses - reads only)
G:6038:battle_flag_counter:Battle flag/counter with RMW (31 accesses)
G:6196:battle_counter_2:Battle counter variable 2 (19 accesses)
G:6195:battle_counter_1:Battle counter variable 1 (17 accesses)
G:6192:battle_output_1:Battle output/store variable 1 (15 accesses)
G:6191:battle_output_2:Battle output/store variable 2 (14 accesses)
G:6197:battle_limit_x:Battle X limit coordinate (12 accesses)
G:6198:battle_limit_y:Battle Y limit coordinate (12 accesses)
G:619B:battle_flags_2:Battle flags 2 (AND/STA operations)
G:61B1:battle_turn_counter:Battle turn counter (INC operations)
G:61DB:battle_indexed_data:Battle indexed data table
G:6165:battle_indexed_2:Battle indexed data table 2
G:6168:battle_indexed_3:Battle indexed data table 3

# ==============================================================================
# SAVE FILE REGIONS (from cowness.net)
# ==============================================================================
G:62EF:save_file_1_start:Save File 1 Start (751 bytes)
G:65DE:save_file_1_end:Save File 1 End
G:65DF:save_file_2_start:Save File 2 Start (752 bytes)
G:68CE:save_file_2_end:Save File 2 End
G:68CF:save_file_3_start:Save File 3 Start (752 bytes)
G:6BBE:save_file_3_end:Save File 3 End

# ==============================================================================
# FIXED BANK SUBROUTINES - Battle State Access
# ==============================================================================
R:CC28:fixed_read_actor_1:Read $615A (battle actor)
R:CF41:fixed_read_actor_2:Read $615A (battle actor)
R:F148:fixed_read_actor_3:Read $615A (battle actor)
R:F15D:fixed_read_actor_4:Read $615A (battle actor)
R:F164:fixed_inc_actor:Increment $615A (advance actor)
R:CCB0:fixed_set_counter_1:Store to $6195 (battle counter 1)
R:CFD7:fixed_cmp_counter_1:Compare $6195 (battle counter 1)
R:CCB8:fixed_set_counter_2:Store to $6196 (battle counter 2)
R:CFDE:fixed_cmp_counter_2:Compare $6196 (battle counter 2)
R:CC16:fixed_cmp_limit_x:Compare $6197 (battle limit X)
R:CC33:fixed_ldx_limit_x:Load X from $6197
R:CC1D:fixed_cmp_limit_y:Compare $6198 (battle limit Y)
R:CC36:fixed_ldy_limit_y:Load Y from $6198

# ==============================================================================
# FIXED BANK - MOST CALLED SUBROUTINES (from cross-reference analysis)
# ==============================================================================
# Top 50 most called subroutines in the fixed bank

R:C90C:wait_for_input:Wait for button input (118 calls)
R:C827:sub_C827:Frequently called utility (56 calls)
R:C5C5:sub_C5C5:Utility routine (48 calls)
R:C62D:sub_C62D:Utility routine (43 calls)
R:C5BF:sub_C5BF:Utility routine (42 calls)
R:C3EA:sub_C3EA:PPU/video related (37 calls)
R:C81D:sub_C81D:Utility routine (36 calls)
R:D3E6:sub_D3E6:Processing routine (35 calls)
R:C78C:sub_C78C:Utility routine (35 calls)
R:C5B9:sub_C5B9:Utility routine (34 calls)
R:D1F3:sub_D1F3:Processing routine (32 calls)
R:C813:sub_C813:Utility routine (31 calls)
R:C851:sub_C851:Text/menu related (31 calls)
R:C8EC:sub_C8EC:RNG related (30 calls)
R:C73E:sub_C73E:Utility routine (30 calls)
R:D218:sub_D218:Processing routine (29 calls)
R:C5AF:sub_C5AF:Utility routine (29 calls)
R:DDE3:text_output:Text rendering (28 calls)
R:C65A:sub_C65A:Utility routine (26 calls)
R:D20A:sub_D20A:Processing routine (24 calls)
R:C54E:sub_C54E:Clear/init routine (23 calls)
R:E771:sub_E771:Processing routine (22 calls)
R:C58F:sub_C58F:Utility routine (18 calls)
R:D214:sub_D214:Processing routine (18 calls)
R:C662:sub_C662:Utility routine (17 calls)
R:C770:sub_C770:Utility routine (16 calls)
R:D804:sub_D804:Processing routine (16 calls)
R:C8CC:sub_C8CC:RNG/random routine (15 calls)

# ==============================================================================
# Bank 18 - Level Up / EXP System Code ($8000-$BFFF when loaded)
# Addresses are CPU addresses when bank 18 is in $8000-$BFFF slot
# The EXP system uses a FORMULA-BASED calculation, not lookup tables
# ==============================================================================

# Level Check and EXP Comparison Routine ($9C22-$9C4F)
R:9C22:b18_level_check_entry:Level check routine entry
R:9C26:b18_cmp_max_level:CMP #$63 - Max level check (99 decimal)
R:9C2A:b18_load_exp_lo:LDA $6E19,X - Load calculated EXP req (low)
R:9C2D:b18_cmp_exp_lo:CMP $601A,X - Compare with party EXP (low)
R:9C30:b18_load_exp_mid:LDA $6E1A,X - Load calculated EXP req (mid)
R:9C33:b18_sbc_exp_mid:SBC $601B,X - Subtract party EXP (mid)
R:9C36:b18_load_exp_hi:LDA $6E1B,X - Load calculated EXP req (high)
R:9C39:b18_sbc_exp_hi:SBC $601C,X - Subtract party EXP (high)

# EXP Requirement Calculation Entry ($9D41-$9D6C)
R:9D41:b18_exp_calc_entry:EXP calculation routine entry
R:9D48:b18_cmp_max_level_2:CMP #$63 - Max level check (99 decimal)
R:9D54:b18_jsr_exp_calc:JSR $9F7C - Call main EXP calculation
R:9D5F:b18_sta_exp_lo:STA $6E19,X - Store EXP requirement (low byte)
R:9D62:b18_sta_exp_mid:STY $6E1A,X - Store EXP requirement (mid byte)
R:9D65:b18_sta_exp_hi:Store EXP requirement (high byte)

# Main EXP Calculation Routine ($9F7C-$9FB8)
R:9F7C:b18_exp_calc_main:Main EXP calculation subroutine
R:9F9C:b18_coeff_table_lookup:Look up character coefficient pointer

# Character EXP Coefficient Pointer Table ($A0FB-$A122)
# 8 entries Ã— 2 bytes = 16-bit pointers to coefficient data
R:A0FB:b18_exp_coeff_ptr_table:Character EXP coefficient pointer table (8 entries)
R:A0FB:b18_exp_ptr_entry_0:Hero coefficient data pointer -> $A123
R:A0FD:b18_exp_ptr_entry_1:Cristo coefficient data pointer -> $A14B
R:A0FF:b18_exp_ptr_entry_2:Nara coefficient data pointer -> $A17B
R:A101:b18_exp_ptr_entry_3:Mara coefficient data pointer -> $A1AB
R:A103:b18_exp_ptr_entry_4:Brey coefficient data pointer -> $A1DB
R:A105:b18_exp_ptr_entry_5:Taloon coefficient data pointer -> $A20B
R:A107:b18_exp_ptr_entry_6:Entry 6 pointer -> $A1AB (shares with Mara)
R:A109:b18_exp_ptr_entry_7:Ragnar coefficient data pointer -> $A23B

# Character EXP Coefficient Data Blocks
R:A123:b18_exp_data_hero:Hero EXP coefficient data (40 bytes)
R:A14B:b18_exp_data_cristo:Cristo EXP coefficient data (48 bytes)
R:A17B:b18_exp_data_nara:Nara EXP coefficient data (48 bytes)
R:A1AB:b18_exp_data_mara:Mara/Entry6 EXP coefficient data (48 bytes)
R:A1DB:b18_exp_data_brey:Brey EXP coefficient data (48 bytes)
R:A20B:b18_exp_data_taloon:Taloon EXP coefficient data (48 bytes)
R:A23B:b18_exp_data_ragnar:Ragnar EXP coefficient data

# ==============================================================================
# EXP System RAM Variables ($6E19-$6E1B range)
# Calculated EXP requirements stored per-character (3 bytes each)
# ==============================================================================
G:6E19:exp_req_calc_lo:Calculated EXP requirement (low byte, indexed by X)
G:6E1A:exp_req_calc_mid:Calculated EXP requirement (mid byte, indexed by X)
G:6E1B:exp_req_calc_hi:Calculated EXP requirement (high byte, indexed by X)

# ==============================================================================
# Bank 19 - Battle System Deep Analysis Labels
# Addresses are CPU addresses when bank 19 is in $8000-$BFFF slot
# ==============================================================================

# Action Dispatch System
R:805B:b19_dispatch_main:Main action dispatcher - reads $6E80 mode
R:8062:b19_load_action_idx:Load action index from $75E8
R:8067:b19_lookup_jmptbl:Look up handler in jump table at $8078
R:8071:b19_indirect_jump:Execute handler via indirect jump

# Math Routines - 16-bit and 24-bit operations
R:8176:b19_mul16_shift4:16-bit left shift x4 (multiply by 16)
R:8187:b19_div16_shift4:16-bit right shift x4 (divide by 16)
R:8198:b19_scale_stat:Scale stat by A register
R:81A5:b19_shift_extended:4-bit shift with extended precision
R:8330:b19_mul16_by_a:16-bit multiply by A (shift-add method)
R:8366:b19_mul24_by_a:24-bit multiply by A (shift-add method)
R:83AA:b19_div16_setup:16-bit division setup
R:83C5:b19_div16_loop:16-bit division loop (16 iterations)
R:83F4:b19_div24_setup:24-bit division setup
R:8414:b19_div24_loop:24-bit division loop (24 iterations)

# Damage Calculation ($AA67-$AB58)
R:AA67:b19_damage_calc_main:Main damage calculation entry
R:AA6F:b19_damage_init:Initialize damage accumulators
R:AA7B:b19_damage_scale_actor:Scale by actor index x16
R:AA9F:b19_damage_divide:Divide by tactics divisor ($BB8B)
R:AAAF:b19_damage_shift_x16:Left shift result x16
R:AACF:b19_damage_add_base:Add base power component
R:AAFB:b19_damage_defense:Apply defense reduction
R:AB38:b19_damage_final:Final damage calculation
R:AB4C:b19_damage_no_defense:Skip defense (result direct copy)

# Resistance Check ($AB59-$AB91)
R:AB59:b19_resist_check_main:Resistance check entry
R:AB6A:b19_resist_load_power:Load attack power values
R:AB78:b19_resist_divide:Divide by resistance
R:AB89:b19_resist_compare:Compare against tactics threshold

# Hit/Miss Determination ($9135-$91A0)
R:9135:b19_hit_check_main:Hit/miss check main entry
R:9144:b19_hit_action_type:Check action type for hit formula
R:919A:b19_hit_standard:Standard hit check (action < $29)
R:91A0:b19_hit_clear_dmg:Clear damage output for miss

# AI Decision Making ($A8C6+)
R:A8C6:b19_ai_main_entry:AI decision making main entry (mode 4)
R:A8D5:b19_ai_init_flags:Initialize AI decision flags
R:A8E1:b19_ai_scan_targets:Scan for valid targets
R:A906:b19_ai_check_spells:Check available spells
R:A92E:b19_ai_select_action:Select best action based on tactics
R:A797:b19_ai_resist_filter:Filter actions by resistance

# Tactics System Data Tables
R:BB84:b19_tbl_attack_mult:Attack multiplier by tactics (7 entries: 10,00,10,10,10,10,10)
R:BB8B:b19_tbl_stat_divisor:Stat divisor by tactics (7 entries: 10,10,00,10,00,00,00)
R:BB92:b19_tbl_hit_threshold:Hit threshold by tactics (7 entries: 66,33,8C,01,FF,01,A0)

# Spell Data Tables
R:BB3F:b19_tbl_spell_power:Spell power table (9 entries)
R:BB49:b19_tbl_spell_attr:Spell attribute table (9 entries)
R:B80B:b19_tbl_action_effect:Action effect type table (256 bytes)
R:B915:b19_tbl_spell_param1:Spell parameter table 1
R:B949:b19_tbl_spell_param2:Spell parameter table 2

# Enemy Data Tables
R:B967:b19_tbl_enemy_resist:Enemy resistance data (256 bytes, packed bits)

# AI Tactics Spell Selection Tables
R:BA74:b19_tbl_tactics_spell1:Tactics spell priority matrix (7x7=49 bytes)
R:BAA5:b19_tbl_tactics_spell2:Tactics spell priority 2 (48 bytes)
R:BAD5:b19_tbl_tactics_spell3:Tactics spell priority 3 (18 bytes)

# Battle System RAM (Additional)
G:75E1:battle_atk_power_lo:Attack power low byte
G:75E2:battle_atk_power_hi:Attack power high byte
G:75ED:battle_party_stat_lo:Party stat sum low byte
G:75EE:battle_party_stat_hi:Party stat sum high byte
G:75EF:battle_defense_val:Defense value for damage reduction
G:75F0:battle_ai_flags:AI decision flags (bit 7 = special mode)
G:75F2:battle_spell_id:Selected spell ID
G:75F3:battle_target_mask_lo:Valid target mask low byte
G:75F4:battle_target_mask_hi:Valid target mask high byte
G:75F5:battle_spell_mask:Available spell mask

# ==============================================================================
# Bank 16 - Game Logic / Scripted Events (PRG ROM $8000-$BFFF when loaded)
# Bank 16 has 75.9% code density with 454 subroutines (most of any switchable bank)
# Contains pointer tables, scripted battle events, and game flow control
# ==============================================================================

# Bank 16 Header / Pointer Tables ($8000-$807F)
R:8000:b16_ptr_table_start:Bank 16 pointer table start (data section)
R:8030:b16_ptr_table_2:Second pointer table section
R:804A:b16_ptr_table_3:Third pointer table section

# Bank 16 Code Entry Points ($8080+)
R:8080:b16_script_entry_1:Script entry point 1 - save state, jump to $815F
R:808A:b16_script_entry_2:Script entry point 2 - similar to $8080
R:8091:b16_script_main:Main scripted event processor
R:809D:b16_get_return_addr:Get return address from stack into $79-$7A
R:80B3:b16_update_return:Update return address on stack
R:80C5:b16_script_entry_3:Script entry point 3 - saves to $6E0B
R:80D1:b16_script_entry_4:Script entry point 4
R:80EA:b16_script_continue:Continue script execution

# Bank 16 Utility Subroutines
R:8157:b16_load_ptr_helper:Load pointer from $0517 into $79
R:815F:b16_save_zp_state:Save zero page $00-$0F to stack
R:8161:b16_save_zp_loop:Zero page save loop
R:8188:b16_restore_zp:Restore zero page from stack
R:8196:b16_process_event:Process scripted event
R:8198:b16_event_loop:Event processing loop
R:81B8:b16_event_done:Event processing complete (RTS)
R:81B9:b16_battle_event:Battle event handler - checks $C000

# Bank 16 Data/State Management
R:8214:b16_copy_zp_76_78:Copy $6F-$71 to $76-$78
R:8221:b16_dispatch_handler:Dispatch to handler via jump table at $9E30
R:823E:b16_jmp_battle_event:Jump to battle event ($81B9)
R:8241:b16_check_618E:Check battle state flag $618E
R:825F:b16_check_618E_2:Second check of $618E
R:8278:b16_compare_y:Compare Y for event type selection

# Bank 16 Event Jump Table at $9E30
R:9E30:b16_event_handler_table:Event handler pointer table (indexed by $6E0B*2)

# Bank 16 Game Flow Control
R:A077:b16_game_flow:Game flow control subroutine (called from $815F dispatcher)
R:A680:b16_indirect_jump_1:Indirect jump via $0000
R:B496:b16_indirect_jump_2:Indirect jump via $0004

# Bank 16 Random Number Usage
R:AC89:b16_rng_call_1:Call RNG ($C891) for event randomization
R:ADC6:b16_rng_call_2:Second RNG call location
R:AF78:b16_rng_call_3:Third RNG call location
R:B09A:b16_rng_call_4:Fourth RNG call location
R:B0A1:b16_rng_call_5:Fifth RNG call location

# Bank 16 Text/Menu Related
R:87C5:b16_text_call_1:Call text routine $C851
R:A27D:b16_text_call_2:Second text routine call
R:A9AD:b16_text_call_3:Third text routine call

# Bank 16 RAM Variables Used
G:6E0A:b16_event_param_a:Event parameter A (used in scripted events)
G:6E0B:b16_event_param_b:Event parameter B (jump table index * 2)
G:6E0C:b16_event_counter:Event counter/index
G:6E0E:b16_event_y_save:Event Y register save
G:6BDD:b16_flag_6bdd:Script flag (bit 7 checked/set)
G:6BDE:b16_flag_6bde:Script flag 2 (saved/restored)

# ==============================================================================
# Bank 17 - Battle Display / AI System (PRG ROM $8000-$BFFF when loaded)
# Bank 17 has 68.2% code density with 450 subroutines
# Contains battle UI, message display, animations, and AI support routines
# Heavy BRK usage indicates scripted event sequences
# ==============================================================================

# Bank 17 Header / Pointer Tables ($8000-$8031)
R:8000:b17_ptr_table_start:Bank 17 pointer table (data section)
R:8022:b17_jmp_to_c49e:Jump to fixed bank $C49E

# Bank 17 Battle Initialization ($8032+)
R:8032:b17_battle_init:Battle initialization - sets $72E9 flag
R:803C:b17_store_72e9:Store battle flag to $72E9
R:8050:b17_call_b9fb:Call battle helper $B9FB
R:8053:b17_battle_loop_1:Battle loop segment 1 (BRK script)
R:8080:b17_battle_segment:Battle segment with BRK scripts
R:808B:b17_battle_segment_2:Battle segment 2
R:809B:b17_rts_quick:Quick return (RTS)
R:809C:b17_check_chapter:Check chapter number ($615A == 3?)

# Bank 17 Battle State Checks
R:80C4:b17_check_72e7:Check battle state $72E7 (bits 5-6)
R:80CD:b17_return_carry_set:Return with carry set
R:80CF:b17_init_battle_arrays:Initialize battle arrays at $72F4+

# Bank 17 Battle Actor Setup
R:80D9:b17_init_actor_loop:Initialize actor data loop ($72F4-$733C)
R:80F7:b17_call_87fb:Call helper $87FB after init
R:8108:b17_check_72e6:Check $72E6 battle flags
R:810F:b17_call_ae0a:Call $AE0A (escape check?)
R:8117:b17_return:Simple return point
R:8118:b17_continue_battle:Continue battle after escape check

# Bank 17 Battle Actor Validation
R:880A:b17_validate_actor:Validate battle actor (uses A as actor type)
R:87BB:b17_setup_actor:Set up actor for battle
R:87FB:b17_actor_helper:Actor setup helper routine

# Bank 17 Battle Display System
R:885B:b17_display_battle:Battle display main routine
R:9223:b17_display_helper:Display helper routine
R:92CF:b17_display_update:Update battle display

# Bank 17 Battle Text/Messages
R:A8EC:b17_message_system:Battle message system
R:AA4C:b17_message_display:Display battle message
R:AB2A:b17_message_continue:Continue message display

# Bank 17 AI/Enemy Actions
R:AE0A:b17_enemy_escape:Enemy escape check routine
R:B9F6:b17_ai_helper_1:AI helper routine 1
R:B9FB:b17_ai_helper_2:AI helper routine 2
R:BEB2:b17_ai_action:AI action execution

# Bank 17 RAM Variables
G:6E44:b17_battle_mode:Battle mode flag (AND #$03 compared)
G:6E45:b17_battle_type:Battle type ($BB = special)
G:6E49:b17_battle_var_49:Battle variable 49
G:6E4A:b17_battle_var_4a:Battle variable 4A
G:6E4B:b17_battle_var_4b:Battle variable 4B
G:6E4C:b17_battle_var_4c:Battle variable 4C
G:6E81:b17_event_state:Event state flag (cleared to 0)
G:72E6:b17_battle_flags_e6:Battle flags E6 (bits 4-5 checked)
G:72E7:b17_battle_flags_e7:Battle flags E7 (bits 5-6 checked)
G:72E9:b17_battle_flag_e9:Battle flag E9 (set to $00/$40/$80)
G:72F4:b17_actor_data_start:Actor data array start (12 entries)
G:7300:b17_actor_array_0:Actor array 0
G:730C:b17_actor_array_1:Actor array 1
G:7318:b17_actor_array_2:Actor array 2
G:7324:b17_actor_array_3:Actor array 3 (init to $F7)
G:7330:b17_actor_array_4:Actor array 4 (init to $F7)
G:733C:b17_actor_array_5:Actor array 5 (init to $F7)

# ==============================================================================
# Bank 29 - Formation / Party Data System (PRG ROM $8000-$BFFF when loaded)
# Bank 29 has 68.7% code density with 372 subroutines
# Contains party formation, positioning, battle setup data
# First $200 bytes are data tables (graphics patterns, formation data)
# ==============================================================================

# Bank 29 Data Tables ($8000-$8095)
R:8000:b29_data_start:Bank 29 data section start
R:802B:b29_party_init:Party initialization entry (writes $0573)
R:8033:b29_slot_lookup_loop:Party slot lookup loop
R:8041:b29_compare_slot:Compare slot with $28
R:8048:b29_slot_not_found:Return - slot not found
R:8049:b29_slot_found:Slot found - process formation

# Bank 29 Formation Processing
R:8064:b29_copy_slot_data:Copy slot data from $7600 to $0574
R:8082:b29_copy_position_data:Copy position data from $80DE to $057C/$0584
R:8095:b29_formation_rts:Formation processing return
R:8096:b29_slot_table:Party slot lookup table
R:809E:b29_slot_flags:Party slot flags table
R:80A2:b29_slot_config:Party slot configuration
R:80A6:b29_slot_indices:Party slot index mapping (8 entries)
R:80DE:b29_position_table:Party position data table

# Bank 29 Graphics/Tile Data ($811E-$819D seems to be tile patterns)
R:811E:b29_tile_pattern_1:Tile pattern data 1
R:815E:b29_tile_pattern_2:Tile pattern data 2

# Bank 29 Core Subroutines
R:8660:b29_call_c0a0_1:Call fixed bank $C0A0
R:86E8:b29_call_c0a0_2:Second call to $C0A0
R:8AA6:b29_call_9f0f_1:Call $9F0F subroutine
R:8AE6:b29_call_9f0f_2:Second call to $9F0F
R:8B43:b29_call_8ce6:Call formation helper $8CE6
R:8BC5:b29_call_8d2c:Call formation helper $8D2C

# Bank 29 Formation Calculation
R:8C9A:b29_calc_formation_entry:Formation calculation entry (4 calls to $8CAC)
R:8CAC:b29_formation_helper:Formation calculation helper (called 4x)
R:8CE6:b29_formation_setup:Formation setup routine
R:8CF3:b29_rng_formation_1:RNG call for formation randomization
R:8CFA:b29_rng_formation_2:Second RNG call for formation
R:8D06:b29_formation_final:Final formation calculation
R:8D2C:b29_formation_adjust:Formation adjustment routine
R:8D56:b29_formation_adjust_2:Formation adjustment 2 (4 calls to $8CAC)

# Bank 29 Party Management
R:8D9E:b29_call_8009:Call party init at $8009
R:8DF4:b29_party_setup_main:Main party setup (calls $C5C5, $C54E, etc)
R:8EA9:b29_party_helper_1:Party setup helper 1
R:8EC4:b29_party_helper_2:Party setup helper 2
R:8E68:b29_party_helper_3:Party setup helper 3
R:8E91:b29_party_helper_4:Party setup helper 4
R:8EE0:b29_party_helper_5:Party setup helper 5

# Bank 29 Data Access Routine
R:9F0F:b29_data_access:Data table access routine (called from $8AA6, $8AE6)

# Bank 29 RAM Variables
G:0573:b29_party_slot_active:Active party slot ($0573)
G:0574:b29_party_data_buffer:Party data buffer (8 bytes, $0574-$057B)
G:057C:b29_position_y_buffer:Party Y position buffer (8 bytes, $057C-$0583)
G:0584:b29_position_x_buffer:Party X position buffer (8 bytes, $0584-$058B)
G:058D:b29_formation_flags:Formation flags
G:7600:b29_char_data_source:Character data source array (indexed by X*4)

# ==============================================================================
# Bank 22 - Menu/UI System (PRG ROM $8000-$BFFF when loaded)
# Bank 22 has 876 subroutines with 519 JSR calls and 224 JMP instructions
# Contains text input, number input, menu display, and UI state management
# Heavy use of BRK-based dispatch for text engine calls
# ==============================================================================

# Bank 22 Entry Points ($8028-$8035)
R:8028:b22_main_entry:Bank 22 main entry point (JSR $872B)
R:802B:b22_init_1:Initialize routine 1 (JSR $85C8)
R:802E:b22_init_2:Initialize routine 2 (JSR $85F9)
R:8031:b22_init_3:Initialize routine 3 (JSR $8036)
R:8035:b22_entry_return:Entry point return (SEC, RTS)

# Bank 22 Main Loop ($8036-$803E)
R:8036:b22_main_loop:Main processing loop
R:803F:b22_check_state:Check state flag $5C

# Bank 22 Character/Tile Validation ($8051-$808B)
R:8051:b22_validate_char:Validate character at $6E8A,X
R:8084:b22_set_char_6c:Set character code $6C
R:8089:b22_clear_state:Clear state variables $5D, $57

# Bank 22 Command Handler Dispatch ($8094-$80C3)
R:8094:b22_cmd_dispatch:Command dispatch based on accumulator
R:80A4:b22_cmd_table_lookup:Lookup handler in table at $80C4
R:80B2:b22_jmp_indirect:Jump indirect through $0000-$0001
R:80B5:b22_cmd_default:Default command handler
R:80C4:b22_cmd_table:Command handler jump table (25 entries)

# Bank 22 Input Processing ($810C-$8160)
R:810C:b22_input_handler_1:Input handler routine 1
R:8124:b22_input_cleanup:Input cleanup (PLA, PLA, RTS)
R:812A:b22_check_buffer:Check buffer at $0553
R:8137:b22_check_done:Check completion and return
R:8140:b22_call_83cd:Call $83CD and $81CC
R:8146:b22_compare_0551:Compare $0551 with $55
R:816D:b22_init_input:Initialize input state

# Bank 22 Text/Display Update ($8190-$81C6)
R:8190:b22_display_loop:Display update loop
R:8199:b22_update_cursor:Update cursor position
R:81B0:b22_wait_input:Wait for input (JSR $C8EC)
R:81CC:b22_process_result:Process input result

# Bank 22 Character Code Lookup ($81EA-$8212)
R:81EA:b22_char_lookup:Character code lookup ($5D AND #$0F)
R:8210:b22_char_table:Character code table
R:8212:b22_char_rts:Character lookup return

# Bank 22 Number Display ($8225-$8254)
R:8225:b22_number_init:Number display initialization
R:823C:b22_number_loop:Number digit processing loop
R:8244:b22_copy_digit:Copy digit to $0554 buffer
R:8257:b22_number_handler_2:Number handler variant 2

# Bank 22 String Buffer Management ($8336-$8355)
R:8336:b22_buffer_start:Initialize buffer index X=0
R:8338:b22_read_buffer:Read from $0554,X buffer
R:8346:b22_clear_buffer_state:Clear buffer state ($5C, $60)
R:8356:b22_get_param:Get parameter from $F9,X (increment $5B)

# Bank 22 String Copy ($835D-$836A)
R:835D:b22_copy_string:Copy string from $03E3 to $0554
R:836B:b22_store_char:Store character at $06AA,X

# Bank 22 Screen Update ($8373-$83A3)
R:8373:b22_screen_update:Screen update routine
R:8386:b22_display_char:Display character (JMP $C65A)
R:838B:b22_check_sign:Check sign at $0553
R:8393:b22_calc_position:Calculate screen position ($0551+$53, $0552+$56)

# Bank 22 Text Validation ($83A4-$83BF)
R:83A4:b22_validate_text:Validate text characters ($69, $6A, $6C, $72)
R:83C0:b22_advance_column:Advance column position

# Bank 22 Scroll/Display ($83CD-$83FA)
R:83CD:b22_scroll_start:Start scroll display
R:83D2:b22_scroll_row:Process scroll row
R:83FB:b22_draw_box:Draw UI box/border

# Bank 22 Box Drawing ($844F-$84ED)
R:844F:b22_draw_top:Draw box top border
R:848A:b22_draw_middle:Draw box middle rows
R:84B1:b22_draw_content:Draw box content row
R:84C4:b22_draw_bottom:Draw box bottom border
R:84EE:b22_draw_box_alt:Alternative box drawing (shifted +3)

# Bank 22 Number Input System ($9FB6-$A0CF)
R:9FB6:b22_num_input_init:Number input initialization ($03DD=#$60)
R:9FBB:b22_num_input_short:Short number input ($03DD=#$20)
R:9FBD:b22_num_store_limit:Store input limit to $03DD, $03CF
R:9FD8:b22_num_input_loop:Number input main loop
R:A004:b22_num_check_confirm:Check confirm button (code #$01)
R:A020:b22_num_check_cancel:Check cancel button (code #$02)
R:A032:b22_num_check_select:Check select (bit check $03CC)
R:A04D:b22_num_check_up:Check up button (code #$05)
R:A067:b22_num_check_down:Check down button (code #$06)
R:A07C:b22_num_check_left:Check left button (code #$07)
R:A0AC:b22_num_check_right:Check right button (code #$08)
R:A0D0:b22_num_update_digit:Update current digit

# Bank 22 Text Input System ($A0E8-$A150)
R:A0E8:b22_text_input_init:Text input initialization
R:A0F7:b22_text_setup:Text input setup
R:A102:b22_text_load_table:Load character table from $A151,X
R:A130:b22_text_input_loop:Text input main loop
R:A151:b22_text_table:Text input lookup table

# Bank 22 Text Input Handlers ($A15A-$A212)
R:A15A:b22_text_check_confirm:Text confirm handler
R:A163:b22_text_call_a362:Call text helper $A362
R:A175:b22_text_backspace:Handle backspace
R:A1A1:b22_text_toggle:Handle toggle selection
R:A1C1:b22_text_input_char:Input new character
R:A1E6:b22_text_shift_buffer:Shift buffer contents

# Bank 22 Helper Routines ($A362+)
R:A362:b22_text_helper_1:Text input helper 1
R:A391:b22_text_helper_2:Text input helper 2
R:A397:b22_text_helper_3:Text input helper 3

# Bank 22 Numeric Display ($B24F-$B341)
R:B24F:b22_display_number:Display number routine
R:B275:b22_digit_offset_table:Digit offset lookup table
R:B278:b22_display_stat:Display stat value
R:B29D:b22_display_error:Display error indicator
R:B2A3:b22_count_table:Count lookup table
R:B2DA:b22_count_check:Count validation check
R:B303:b22_count_fail:Count validation failure
R:B307:b22_display_value:Display numeric value
R:B337:b22_load_pointer:Load pointer from $07B5-$07B6
R:B342:b22_display_formatted:Display formatted value

# Bank 22 RAM Variables Used
G:03CA:b22_cursor_char:Cursor character code
G:03CC:b22_input_code:Input button code
G:03CF:b22_cursor_y:Cursor Y position
G:03DC:b22_digit_index:Current digit index
G:03DD:b22_input_limit:Input digit limit
G:03DB:b22_current_digit:Current digit value (0-9)
G:03E3:b22_input_buffer:Input buffer (8 bytes, $03E3-$03EA)
G:03FF:b22_buffer_index:Buffer write index
G:0551:b22_column_pos:Column position in text
G:0552:b22_row_pos:Row position in text
G:0553:b22_display_mode:Display mode flags
G:0554:b22_text_buffer:Text output buffer (variable length)
G:06AA:b22_char_output:Character output buffer

# ==============================================================================
# Bank 15 - System Core / NMI / PPU / MMC1 (PRG ROM $8000-$BFFF when loaded)
# Bank 15 has 564 subroutines with 555 JSR calls and 221 JMP instructions
# This is the core system bank containing:
# - NMI handler and VBlank processing
# - PPU buffer upload system
# - OAM DMA and sprite handling
# - MMC1 mapper register control
# - Bank switching infrastructure
# - BRK instruction handler
# - System initialization and reset
# ==============================================================================

# Bank 15 Jump Table ($8000-$803C)
R:8000:b15_jmp_table:Bank 15 jump table start ($FF then JMP vectors)
R:8001:b15_jmp_e9ce:JMP to $E9CE vector
R:8004:b15_jmp_e54b:JMP to $E54B vector
R:8007:b15_jmp_f1ab:JMP to $F1AB vector
R:800A:b15_jmp_efdb:JMP to $EFDB vector
R:800D:b15_jmp_efd7:JMP to $EFD7 vector
R:8010:b15_jmp_f1fa:JMP to $F1FA vector
R:8013:b15_jmp_f223:JMP to $F223 vector
R:8016:b15_jmp_e944:JMP to $E944 vector
R:802E:b15_jmp_f4ab:JMP to $F4AB vector
R:8031:b15_jmp_f58a:JMP to $F58A vector
R:8034:b15_jmp_f58b:JMP to $F58B vector
R:8037:b15_jmp_fabe:JMP to $FABE vector

# Bank 15 Reset/Init Sequence ($803D-$80CF)
R:803D:b15_reset_entry:Reset entry point (CLD)
R:803E:b15_wait_vbl_1:Wait for VBlank 1
R:8043:b15_wait_vbl_2:Wait for VBlank 2
R:804E:b15_ppu_init:PPU initialization (PPUCTRL=#$10)
R:8058:b15_mapper_init:MMC1 mapper reset (5x STA $FFFF)
R:8067:b15_nmi_setup:Setup NMI JMP vector at $0502
R:8078:b15_stack_init:Initialize stack pointer (LDX #$FF, TXS)
R:807E:b15_ram_clear:Clear RAM ($00-$FF, $0300-$07FF)
R:8092:b15_config_init:Initialize config ($0500=#$0E, $0501=#$10)
R:809E:b15_ppu_setup:PPU final setup
R:80BE:b15_post_init:Post-initialization (JSR $C569, $C543, $FF74)
R:80CF:b15_start_game:Jump to main game loop ($C968)

# Bank 15 VBlank Wait Utilities ($80D6-$80E8)
R:80D6:b15_vbl_wait_util:VBlank wait utility (JSR $FB10)
R:80D9:b15_wait_not_vbl:Wait for NOT VBlank
R:80DE:b15_wait_is_vbl:Wait for VBlank
R:80E3:b15_wait_not_vbl_2:Wait for NOT VBlank (exit condition)

# Bank 15 Soft Reset ($80E9-$8103)
R:80E9:b15_soft_reset:Soft reset (NMI=#$40, mapper reset)
R:8101:b15_soft_reset_jmp:Jump to $C101 after soft reset

# Bank 15 Mapper/Bank Control ($8104-$8159)
R:8104:b15_inc_mapper:Increment mapper $FFDF
R:8118:b15_write_9fff:Write MMC1 control register ($9FFF)
R:812F:b15_write_bfff:Write MMC1 CHR bank 0 ($BFFF)
R:8146:b15_write_dfff:Write MMC1 CHR bank 1 ($DFFF)

# Bank 15 NMI Handler ($815A-$8218)
R:815A:b15_nmi_entry:NMI handler entry (PHA, TXA, PHA, TYA, PHA)
R:815F:b15_nmi_check_busy:Check if system busy ($1F bit 7)
R:8163:b15_nmi_stack_check:Check stack for valid return
R:8175:b15_nmi_ppu_update:PPU update during NMI
R:8181:b15_nmi_range_check:Check return address range
R:819B:b15_nmi_skip_check:Check NMI skip flag ($0519)
R:81B0:b15_nmi_bank_switch:Bank switch during NMI ($FF91)
R:81BD:b15_nmi_stack_fixup:Stack fixup for return address
R:81EF:b15_nmi_inc_counter:Increment $050C counter
R:8213:b15_nmi_exit_normal:Normal NMI exit (PLA, TAY, PLA, TAX, PLA, RTI)
R:8219:b15_nmi_exit_brk:NMI exit to BRK handler

# Bank 15 PPU Buffer Upload ($8222-$8296)
R:8222:b15_ppu_check_flags:Check state flags for PPU update
R:823A:b15_ppu_buffer_start:Start PPU buffer upload
R:8241:b15_ppu_buffer_loop:PPU buffer upload loop
R:825C:b15_ppu_write_addr:Write PPU address
R:8267:b15_ppu_write_data:Write PPU data bytes
R:8276:b15_ppu_palette:Handle palette update ($3F00)
R:8296:b15_ppu_buffer_done:PPU buffer upload complete

# Bank 15 PPU 9-byte Block Upload ($8297-$82E9)
R:8297:b15_ppu_block_start:9-byte block upload start
R:8299:b15_ppu_block_loop:9-byte block upload loop
R:82E7:b15_ppu_block_done:Block upload done, JMP $C276

# Bank 15 PPU Register Update ($82EA-$8302)
R:82EA:b15_ppu_regs_update:Update PPU control registers
R:82F6:b15_ppu_scroll_set:Set scroll registers ($2005)

# Bank 15 OAM DMA ($8303-$8314)
R:8303:b15_oam_check:Check OAM update needed
R:830F:b15_oam_dma:Perform OAM DMA ($4014=#$02)

# Bank 15 Nametable Clear ($8315-$837A)
R:8315:b15_nt_clear_start:Nametable clear start
R:8318:b15_nt_clear_loop:Nametable clear loop
R:837B:b15_nt_addr_table:Nametable address table data

# Bank 15 Inter-Bank Call System ($838B-$83E9)
R:838B:b15_bank_call_entry:Bank call entry (STA $20, STX $21)
R:839A:b15_bank_call_setup:Setup bank call (JSR $C3BA)
R:83A6:b15_bank_call_exec:Execute bank call (JSR $0023)
R:83B0:b15_bank_call_restore:Restore bank after call
R:83BA:b15_bank_lookup:Bank lookup from table
R:83CE:b15_bank_ptr_get:Get pointer for bank call
R:83EA:b15_bank_indirect:Indirect bank call

# Bank 15 BRK Handler ($8408-$84F7)
R:8408:b15_brk_entry:BRK handler entry (SEI, PHP)
R:8413:b15_brk_get_pc:Get BRK program counter from stack
R:8423:b15_brk_decode:Decode BRK operand byte
R:8432:b15_brk_dispatch:Dispatch based on operand type
R:8451:b15_brk_indirect:Handle indirect BRK call
R:8460:b15_brk_special_03:Handle opcode $x3 variant
R:8463:b15_brk_check_cb:Check for $CB-$FA range
R:8484:b15_brk_bank_16:Dispatch to Bank 16 ($CB-$CA)
R:84A1:b15_brk_advance_pc:Advance PC past BRK operand
R:84B6:b15_brk_flag_test:Test event flag ($627B,X)
R:84CA:b15_brk_flag_set:Set event flag (OR)
R:84E1:b15_brk_flag_clear:Clear event flag (AND)
R:84F8:b15_brk_special:Special BRK handling

# Bank 15 System State ($852F-$8542)
R:852F:b15_clear_state:Clear system state ($1F, $050A-$0513)

# Bank 15 OAM Clear ($8543-$854D)
R:8543:b15_oam_clear:Clear OAM buffer ($0200, #$F7)

# Bank 15 Screen Control ($854E-$85B8)
R:854E:b15_screen_on_full:Full screen on sequence
R:8569:b15_clear_ppu_buffer:Clear PPU buffer ($0400)
R:8575:b15_clear_nametable:Clear nametable ($2000)
R:858F:b15_screen_on:Turn screen on
R:8596:b15_screen_wait_vbl:Wait for VBlank then enable
R:85A8:b15_busy_clear:Clear busy flag ($1F AND #$7F)
R:85AF:b15_screen_off:Turn screen off (set busy)

# Bank 15 PPU/Hardware Registers Used
P:2000:PPUCTRL:PPU Control Register
P:2001:PPUMASK:PPU Mask Register
P:2002:PPUSTATUS:PPU Status Register
P:2005:PPUSCROLL:PPU Scroll Position
P:2006:PPUADDR:PPU Address Register
P:2007:PPUDATA:PPU Data Port
P:4014:OAMDMA:OAM DMA Register

# Bank 15 MMC1 Mapper Registers
P:9FFF:MMC1_CONTROL:MMC1 Control Register
P:BFFF:MMC1_CHR_BANK0:MMC1 CHR Bank 0
P:DFFF:MMC1_CHR_BANK1:MMC1 CHR Bank 1
P:FFFF:MMC1_PRG_BANK:MMC1 PRG Bank Select

# ==============================================================================
# Bank 30 - NPC/Sprite/Map Event System (PRG ROM $8000-$BFFF when loaded)
# Bank 30 has 863 subroutines with 633 JSR calls (highest of switchable banks)
# Contains NPC movement, sprite handling, map events, player interaction
# Uses $6F40-$6FE0 for NPC/sprite tables, $7000-$71FF for object state
# Heavy BRK-based dispatch for event scripting
# ==============================================================================

# Bank 30 Data Tables ($8000-$8093)
R:8000:b30_data_start:Bank 30 data section start (event pointers)
R:8094:b30_code_start:Bank 30 code section start

# Bank 30 Event Dispatch ($8094-$80A6)
R:8094:b30_event_entry:Event handler entry point
R:8096:b30_event_dispatch:Event dispatch (BRK $07, $6F)
R:809C:b30_event_table_lookup:Lookup in event table at $80AA
R:80A7:b30_event_fallback:Fallback to $D1F3
R:80AA:b30_event_table:Event handler jump table

# Bank 30 Player/NPC Interaction ($80BA-$80F8)
R:80BA:b30_check_player:Check player interaction flag ($41 bit 4)
R:80BE:b30_npc_init:NPC interaction initialization
R:80CA:b30_rng_check:RNG check for NPC (JSR $D3E6)
R:80E2:b30_npc_direction:Set NPC direction
R:80EA:b30_event_trigger:Trigger map event (JSR $BAEA)
R:80F2:b30_return_fail:Return with failure code ($F0)

# Bank 30 NPC Search ($80F9-$8145)
R:80F9:b30_store_npc_index:Store NPC index to $059C
R:8101:b30_update_npc_state:Update NPC state at $7000,X
R:8117:b30_save_state:Save state (JSR $D7FC, $FF74)
R:8126:b30_find_npc:Find NPC in $7020 table
R:8128:b30_find_npc_loop:NPC search loop ($7020-$7040)
R:8142:b30_not_found:NPC not found (CLC, RTS)
R:8144:b30_found:NPC found (SEC, RTS)

# Bank 30 Map/Location Check ($8146-$819D)
R:8146:b30_location_check:Location check routine
R:814C:b30_loc_table_search:Search location table at $819E
R:8165:b30_loc_check_flags:Check location flags at $62ED
R:8178:b30_loc_copy_state:Copy location state from $6FE0
R:818F:b30_loc_next_entry:Advance to next table entry (+5)
R:819E:b30_loc_table:Location lookup table data

# Bank 30 Position Helpers ($81AE-$81CC)
R:81AE:b30_get_player_pos:Get player position from $6F60/$6F80
R:81B8:b30_adjust_position:Adjust position by direction

# Bank 30 Event Scripts ($81CD-$823D)
R:81CD:b30_event_script_1:Event script handler 1
R:81D8:b30_check_event_ff:Check for event code $FF
R:81E9:b30_store_event:Store event to $07B9
R:81FF:b30_call_c8cc:Call text routine $C8CC
R:821F:b30_event_branch:Event branch based on value

# Bank 30 Wagon/Party Movement ($84BD-$8576)
R:84BD:b30_wagon_check:Wagon state check
R:84C4:b30_wagon_flags:Set wagon flags ($0531-$0533)
R:84CC:b30_wagon_init:Initialize wagon state
R:84F3:b30_party_walk_calc:Calculate party walking speed
R:8500:b30_walk_loop_start:Walking animation loop
R:8524:b30_walk_shift:Shift walk counter
R:852A:b30_walk_frame_loop:Walk frame loop
R:8547:b30_walk_speed_calc:Calculate walk speed by $058E

# Bank 30 NPC Animation ($854E-$8576)
R:854E:b30_npc_animate_full:Full NPC animation sequence
R:855A:b30_npc_animate_calc:Calculate NPC animation
R:856E:b30_npc_set_visible:Set NPC visible ($7020,X |= $80)

# Bank 30 Map Transition ($8577-$85A3)
R:8577:b30_map_transition:Map transition handler
R:8587:b30_transition_animate:Animate during transition
R:8597:b30_transition_complete:Complete transition

# Bank 30 Sprite Update ($85A4-$8675)
R:85A4:b30_sprite_update:Update sprite data at $7007-$7009
R:85DF:b30_sprite_setup:Sprite setup (LDX #$09, JSR $D804)
R:85EC:b30_sprite_loop:Sprite animation loop
R:8606:b30_sprite_clear_flags:Clear sprite flags ($7007,X AND #$7F)
R:861E:b30_sprite_full_update:Full sprite update sequence

# Bank 30 Map Position ($8700-$8726)
R:8700:b30_map_pos_init:Initialize map position (JSR $894A)
R:8706:b30_check_map_45:Check for map $45
R:871E:b30_toggle_map_flag:Toggle map flag at $62AA

# Bank 30 Party Setup ($8726-$876A)
R:8726:b30_party_setup:Party setup routine
R:8729:b30_party_init_call:Initialize party (JSR $8A0D)
R:8733:b30_party_state:Update party state at $7000

# Bank 30 Animation Helpers ($86DD-$86FF)
R:86DD:b30_animate_helper:Animation helper (E06E, D7D5, CBB4)
R:86E6:b30_animate_speed:Calculate animation speed

# Bank 30 NPC Data Structures
G:6F40:b30_npc_type:NPC type array (32 entries)
G:6F60:b30_npc_x_pos:NPC X position array (32 entries)
G:6F80:b30_npc_y_pos:NPC Y position array (32 entries)
G:6FE0:b30_npc_state:NPC state array (32 entries)
G:6FE9:b30_sprite_counter:Sprite update counter
G:7000:b30_object_flags:Object flags array
G:7007:b30_follower_state_0:Follower 0 state
G:7008:b30_follower_state_1:Follower 1 state
G:7009:b30_follower_state_2:Follower 2 state
G:7020:b30_active_npcs:Active NPC indices (32 entries)
G:7029:b30_npc_visibility:NPC visibility flags
G:70E0:b30_npc_flags:NPC processing flags (32 entries)
G:7169:b30_party_visibility:Party visibility flag

# Bank 30 Map Variables
G:0515:b30_transition_mode:Map transition mode
G:0531:b30_wagon_flag_1:Wagon state flag 1
G:0532:b30_wagon_flag_2:Wagon state flag 2
G:0533:b30_wagon_flag_3:Wagon state flag 3
G:058E:b30_party_speed:Party movement speed
G:058F:b30_walk_toggle:Walking animation toggle
G:0597:b30_transition_state:Transition state flag
G:059C:b30_current_npc:Current NPC index
G:060A:b30_sprite_index:Current sprite index
G:62A5:b30_chapter_flags:Chapter state flags
G:62AA:b30_map_toggle:Map toggle state
G:62ED:b30_event_state:Event state flag ($78 = chapter boundary)
G:6F87:b30_party_x_pos:Party X position
G:6F88:b30_party_y_pos:Party Y position
G:6FC7:b30_saved_x:Saved X position
G:6FC8:b30_saved_y:Saved Y position

# ==============================================================================
# Bank 20 - Shop/Merchant System (PRG ROM $8000-$BFFF when loaded)
# Bank 20 has 793 subroutines with 628 JSR calls
# Contains shop menus, item buying/selling, price calculations
# Uses $6E45-$6E49 for shop inventory, $0440 for item slots
# ==============================================================================

# Bank 20 Data/Initialization ($8000-$8037)
R:8000:b20_entry:Bank 20 shop entry point
R:8038:b20_init_loop:Shop initialization loop (JSR $8211)
R:803F:b20_clear_buffers:Clear shop buffers (JSR $C5AF)
R:8046:b20_clear_06a0:Clear $06A0-$06A7 buffer
R:804E:b20_clear_05fc:Clear $05FC-$0615 buffer

# Bank 20 Shop Setup ($805A-$808B)
R:805A:b20_clear_state:Clear shop state ($CA, $C9)
R:8062:b20_clear_6e49:Clear item count buffer ($6E49-$6E4C)
R:806A:b20_clear_0444:Clear $0444-$044B buffer
R:8072:b20_load_inventory:Load shop inventory loop
R:808B:b20_process_items:Process shop items loop

# Bank 20 Special Item Check ($8092-$80AD)
R:8092:b20_check_special:Check for special item $99
R:809E:b20_set_special:Set special shop values ($0600-$0602)
R:80AD:b20_store_item:Store item code to $C4

# Bank 20 Item Validation ($80B2-$80E4)
R:80B2:b20_validate_item:Validate shop item
R:80B9:b20_call_9f0c:Call item lookup $9F0C
R:80BC:b20_call_92ef:Call price calc $92EF
R:80BF:b20_call_9c54:Call item check $9C54
R:80C2:b20_call_9496:Call item display $9496
R:80E1:b20_call_946e:Call item helper $946E

# Bank 20 Inventory Management ($80EE-$812C)
R:80EE:b20_inventory_loop:Inventory processing loop
R:8103:b20_call_9ed1:Call display $9ED1
R:8106:b20_call_93d2:Call stats $93D2
R:8109:b20_call_9e7f:Call refresh $9E7F
R:8111:b20_check_7392:Check item at $7392,X
R:8126:b20_finalize:Finalize shop display (JSR $9C71)

# Bank 20 Shop Interaction ($812F-$81CC)
R:812F:b20_shop_main:Main shop interaction entry
R:8135:b20_call_9292:Call $9292
R:8138:b20_call_926b:Call $926B
R:8141:b20_item_loop:Item selection loop
R:8162:b20_check_buy:Check if can buy (JSR $9ADD)
R:8167:b20_check_sell:Check if can sell (JSR $9C4A)
R:816C:b20_check_price:Check price (JSR $9439)
R:8171:b20_check_equip:Check equipment (JSR $93F2)
R:817A:b20_check_type:Check item type (JSR $9682)
R:817F:b20_check_valid:Final validation (JSR $9686)
R:8184:b20_complete_buy:Complete purchase
R:8198:b20_store_purchase:Store purchased item
R:81A4:b20_update_count:Update item count

# Bank 20 Item Removal ($81F4-$8210)
R:81F4:b20_remove_item:Remove item from inventory
R:8205:b20_clear_slot:Clear last slot

# Bank 20 Display Update ($8211-$822F)
R:8211:b20_update_display:Update shop display
R:8220:b20_alt_display:Alternative display update
R:822F:b20_display_main:Main display routine

# Bank 20 Special Displays ($8237-$82CB)
R:8237:b20_check_ae:Check for special item $AE
R:823E:b20_ae_display:Display special item $AE sequence
R:8263:b20_normal_display:Normal item display
R:8277:b20_check_bc:Check for special item $BC
R:827E:b20_ppu_setup:Setup PPU for display
R:82CC:b20_call_9a40:Call display helper $9A40

# Bank 20 OAM Clear ($81CF-$81F3)
R:81CF:b20_oam_clear:Clear OAM buffer ($F7 pattern)
R:81DE:b20_oam_dma:Trigger OAM DMA ($4014)
R:81E8:b20_sprite_loop:Sprite update loop

# Bank 20 Shop Variables
G:00C4:b20_current_item:Current item code
G:00C5:b20_item_count:Current item count
G:00C6:b20_slot_index:Current slot index (0-3)
G:00C7:b20_display_index:Display index (0-7)
G:00C9:b20_price_lo:Price accumulator low
G:00CA:b20_price_hi:Price accumulator high
G:0440:b20_item_slots:Shop item slots (4 bytes)
G:0444:b20_item_counts:Shop item counts (8 bytes)
G:0600:b20_special_data_0:Special shop data 0
G:0601:b20_special_data_1:Special shop data 1
G:0602:b20_special_data_2:Special shop data 2
G:0690:b20_display_buffer:Display buffer (indexed by $C7)
G:06A0:b20_price_buffer:Price display buffer (8 bytes)

# ==============================================================================
# BANK 21 ($8000-$BFFF) - Event Script System / Bytecode Interpreter
# ==============================================================================

# Data Tables at Start (first ~8KB is text/event data)
# Event scripts start with BRK opcodes as bytecode commands

# -- Script Flow Control Routines ($A4xx) --
P:A47C:b21_event_process_gold:Process gold for event
P:A489:b21_setup_npc_return:Setup NPC and return
P:A48C:b21_npc_dialog_end:NPC dialog end routine
P:A495:b21_npc_dialog_start:NPC dialog start routine
P:A49E:b21_set_npc_sprite_11:Set NPC sprite to $11
P:A4B6:b21_execute_bytecode_07DF:Execute bytecode $07DF
P:A4BA:b21_run_event_with_cc:Run event with C8CC routine
P:A4C9:b21_call_fixed_bank:Call fixed bank routine via B7B5
P:A4F0:b21_check_item_77:Check if player has item $77

# -- Script Branching Routines ($A5xx) --
P:A501:b21_loop_until_clear:Loop until condition clear
P:A504:b21_wait_loop:Wait loop (check 9AC9)
P:A50F:b21_dialog_with_cb04:Dialog routine with $CB04
P:A521:b21_conditional_dialog:Conditional dialog routine
P:A52C:b21_slot_5_handler:Handler for slot 5 item
P:A573:b21_validate_item_count:Validate item count
P:A582:b21_item_price_calc:Calculate item price
P:A59F:b21_get_item_price:Get item price routine
P:A5A2:b21_store_price_result:Store price calculation result
P:A5BE:b21_price_display_4B33:Price display via $4B33
P:A5CF:b21_continue_or_exit:Continue or exit selection
P:A5E1:b21_exit_to_64C:Exit to $A64C
P:A5E4:b21_calc_high_level_price:Calculate high level price
P:A5FA:b21_calc_standard_price:Calculate standard item price

# -- Script Result Handlers ($A6xx) --
P:A60D:b21_shift_price_6bits:Shift price right 6 bits
P:A614:b21_price_shift_loop:Price shift loop
P:A62B:b21_return_from_shift:Return from shift routine
P:A62C:b21_set_fixed_price:Set fixed price ($EA60)
P:A650:b21_set_result_06:Set result to $06
P:A654:b21_set_result_05:Set result to $05
P:A658:b21_set_result_04:Set result to $04
P:A65C:b21_set_result_03:Set result to $03
P:A660:b21_set_result_02:Set result to $02
P:A664:b21_set_result_00:Set result to $00
P:A668:b21_set_result_01:Set result to $01
P:A66A:b21_set_custom_result:Set custom result from A
P:A673:b21_branch_to_result:Branch to result handler
P:A676:b21_jump_to_9919:Jump to $9919

# -- NPC/Map Setup Routines ($A6xx-$A7xx) --
P:A679:b21_npc_position_setup:NPC position setup (44=$0E, 45=$05)
P:A689:b21_store_direction:Store direction in $DD
P:A694:b21_check_map_location:Check map 19:01 for special event
P:A6A3:b21_call_bc_a6b7:Call $A6BC then $A6B7
P:A6A6:b21_call_a6b7_only:Call $A6B7 only
P:A6A9:b21_load_npc_and_enter:Load NPC and enter map
P:A6B7:b21_call_bank_07:Call bank via $07 + B7B5
P:A6BC:b21_push_dd_call_aea6:Push $DD and call $AEA6
P:A6C5:b21_save_da_range:Save $DA-$E9 to stack

# -- Script Name/Text Handlers ($A7xx) --
P:A732:b21_unknown_a732:Unknown routine at $A732
P:A738:b21_unknown_a738:Unknown routine at $A738
P:A769:b21_check_flag:Check game flag routine
P:A774:b21_set_flag:Set game flag routine

# -- Script Parsing Routines ($99xx-$9Axx) --
P:9914:b21_add_5_to_x:Add 5 to X register
P:9919:b21_event_dispatch:Main event bytecode dispatch
P:9925:b21_init_event_vars:Initialize event variables
P:9956:b21_clear_f9_fb:Clear $F9-$FB via $46EF
P:9962:b21_check_event_range:Check event range and handle
P:9972:b21_call_b7fb_continue:Call B7FB and continue
P:999E:b21_calc_event_offset:Calculate event offset from $00/$01
P:99A9:b21_lookup_event_table:Lookup in event table at $98F6
P:99CE:b21_read_script_byte:Read script byte at ($DA),Y
P:99D6:b21_set_dc_ff:Set $DC to $FF
P:99D8:b21_store_dc:Store to $DC
P:99E7:b21_cmd_02_handler:Command $02 handler (call $9A93)
P:99F1:b21_cmd_1e_handler:Command $1E handler (call $9AC3)
P:99FB:b21_cmd_05_handler:Command $05 handler (call $9AC9)
P:9A05:b21_cmd_13_handler:Command $13 handler (call $9AD1)
P:9A0F:b21_cmd_03_handler:Command $03 handler (call $9AF5)
P:9A19:b21_cmd_14_handler:Command $14 handler (call $9B09)
P:9A23:b21_cmd_16_handler:Command $16 handler (call $9B10)
P:9A2D:b21_cmd_1b_handler:Command $1B handler (call $9A96)
P:9A37:b21_cmd_1c_handler:Command $1C handler (call $9AA3)
P:9A41:b21_cmd_1a_handler:Command $1A handler (call $9AB0)
P:9A4C:b21_check_dc_result:Check $DC result and branch
P:9A5A:b21_true_branch:True branch (DC=0, result!=0)
P:9A6A:b21_false_branch:False branch
P:9A7B:b21_check_cmd_06:Check for command $06
P:9A8C:b21_cmd_11_impl:Command $11 implementation (check flag)
P:9A93:b21_cmd_02_impl:Command $02 - return $E9
P:9A96:b21_cmd_1b_impl:Command $1B - AND flag check
P:9AA3:b21_cmd_1c_impl:Command $1C - ORA flag check
P:9AB0:b21_cmd_1a_impl:Command $1A - CMP flag check
P:9ABF:b21_return_00:Return $00 (false)
P:9ABB:b21_return_ff:Return $FF (true)
P:9AC3:b21_cmd_1e_impl:Command $1E - get value via $2973
P:9AC9:b21_check_party_status:Check party status via B7B5 $48
P:9AD1:b21_cmd_13_impl:Command $13 - character slot lookup
P:9AD4:b21_slot_range_check:Slot range check
P:9AEF:b21_branch_point:Script branch point

# -- Party Member Routines ($9Bxx-$9Cxx) --
P:9B09:b21_cmd_14_impl:Command $14 implementation
P:9B10:b21_cmd_16_impl:Command $16 implementation
P:9B1D:b21_unknown_9b1d:Unknown routine at $9B1D
P:9BA8:b21_script_advance:Advance script pointer

# -- Map Event Routines ($9Cxx-$9Exx) --
P:9C92:b21_unknown_9c92:Unknown routine at $9C92
P:9CBF:b21_unknown_9cbf:Unknown routine at $9CBF
P:9CE5:b21_check_special_cond:Check special condition
P:9E72:b21_set_npc_dir_03:Set NPC direction to $03
P:9E82:b21_item_74_check:Check for item $74
P:9E98:b21_item_74_return:Return from item 74 check
P:9E99:b21_gold_accumulator:Gold accumulator routine
P:9EC8:b21_next_char_loop:Next character loop
P:9ED5:b21_recruitment_handler:Recruitment handler
P:9EF3:b21_find_party_slot:Find party slot routine
P:9F34:b21_branch_9f34:Script branch at $9F34
P:9F45:b21_branch_9f45:Script branch at $9F45
P:9F48:b21_jmp_9f34:Jump to $9F34
P:9F4B:b21_branch_9f4b:Script branch at $9F4B
P:9F4E:b21_check_and_process:Check and process routine
P:9F6B:b21_branch_9f6b:Script branch at $9F6B
P:9F6E:b21_clear_e7_return:Clear $E7 and return
P:9F73:b21_branch_9f73:Script branch at $9F73
P:9F79:b21_inc_counters:Increment $628C/$628D counters
P:9F90:b21_party_member_loop:Party member loop
P:9FD5:b21_return_9fd5:Return from party loop

# -- Text/Dialog Routines ($A0xx-$A1xx) --
P:A00D:b21_set_result_01_jmp:Set result 01 and jump
P:A016:b21_call_664_then_9ac9:Call $A664 then $9AC9
P:A02B:b21_fixed_gold_display:Fixed gold amount display
P:A04C:b21_clear_e7_return2:Clear $E7 and return
P:A051:b21_item_6d_handler:Item $6D handler
P:A068:b21_call_b0ae_a495:Call $B0AE then $A495
P:A06E:b21_char_level_calc:Character level calculation
P:A0A2:b21_dialog_with_push:Dialog routine with E0/E1 push
P:A0C3:b21_loop_9ac9_check:Loop checking $9AC9
P:A0CE:b21_post_loop_handler:Post loop handler
P:A0FF:b21_setup_menu_82:Setup menu with $82

# -- NPC Movement/Positioning ($AExx-$AFxx) --
P:AE58:b21_pop_e0_e1_call:Pop E0/E1 and call $A668
P:AE61:b21_push_regs_continue:Push regs and continue
P:AE98:b21_set_00_branch:Set $00 and branch
P:AEA6:b21_setup_npc_data:Setup NPC data from $62xx
P:AEAE:b21_loop_inc_data:Loop and increment data
P:AEBB:b21_return_aebc:Return from data loop
P:AEBC:b21_clear_f9_fb_2:Clear F9/FA/FB to $00
P:AEC7:b21_jmp_a664:Jump to $A664
P:AECA:b21_call_b067:Call $B067 and loop
P:AED0:b21_check_eb04:Check $EB04 result
P:AEE4:b21_jmp_a660:Jump to $A660
P:AEE7:b21_store_x_to_f9:Store X to $F9
P:AEE9:b21_jmp_a668:Jump to $A668
P:AEEC:b21_call_a65c:Call $A65C
P:AEFD:b21_jmp_a658:Jump to $A658
P:AF00:b21_item_5b_handler:Item $5B handler
P:AF20:b21_branch_af20:Script branch at $AF20
P:AF24:b21_check_62a4:Check $62A4 high nibble
P:AF36:b21_call_a660:Call $A660
P:AF39:b21_call_a65c_2:Call $A65C (2)
P:AF6B:b21_jmp_b0d7:Jump to $B0D7
P:AF72:b21_party_swap:Party swap routine
P:AF80:b21_swap_loop:Swap loop
P:AFA5:b21_swap_complete:Swap complete, call $A664
P:AFAC:b21_msg_2e_handler:Message $2E handler
P:AFB4:b21_call_d214:Call $D214
P:AFBD:b21_setup_party_slot1:Setup party slot 1
P:AFF0:b21_special_map_1901:Special map 19:01 handler

# -- Utility Routines ($B0xx) --
P:B03F:b21_unknown_b03f:Unknown routine at $B03F (load NPC?)
P:B067:b21_unknown_b067:Unknown routine at $B067
P:B083:b21_set_0555_40:Set $0555,X to $40
P:B089:b21_item_check_get:Check and get item
P:B098:b21_return_carry_set:Return with carry set
P:B09A:b21_item_display:Display item routine
P:B0AE:b21_set_e7_01:Set $E7 to $01 (event active)
P:B0B2:b21_set_e7_c0:Set $E7 to $C0
P:B0B6:b21_set_e7_80:Set $E7 to $80
P:B0B8:b21_store_e7:Store A to $E7
P:B0BB:b21_push_check_41:Push and check condition $41
P:B0CE:b21_msg_with_d214:Message with D214 call
P:B0D7:b21_msg_with_d218:Message with D218 call
P:B0E6:b21_chapter_check:Chapter/map check routine
P:B0EF:b21_check_map_03:Check if map is $03
P:B0FF:b21_jmp_b189:Jump to $B189

# -- Name/Text Display ($B1xx-$B2xx) --
P:B1EF:b21_save_regs_push:Save registers and push
P:B1F6:b21_push_da_db:Push $DA/$DB
P:B21C:b21_read_name_loop:Read name from table loop
P:B22B:b21_end_of_name:End of name marker ($80+)
P:B237:b21_restore_da_db:Restore $DA/$DB from stack
P:B243:b21_check_party_flags:Check party flags for suffix
P:B25C:b21_check_special_map:Check for special map text
P:B28C:b21_check_map_1600:Check for map $16:$00
P:B2A3:b21_scan_name_table:Scan name table for map/submap
P:B2C8:b21_inc_da_db:Increment $DA/$DB pointer
P:B2CF:b21_lookup_item_name:Lookup item name by ID
P:B2E2:b21_use_fixed_name:Use fixed item name
P:B2F4:b21_check_map_22:Check for map $22
P:B316:b21_check_map_0401:Check for map $04:$01
P:B340:b21_default_name:Default item name lookup
P:B35F:b21_simple_name_lookup:Simple name lookup
P:B374:b21_clear_party_list:Clear party list ($61DB-$625A)
P:B38A:b21_count_party_members:Count party members
P:B3A1:b21_add_to_party:Add character to party
P:B3CA:b21_remove_from_party:Remove character from party

# -- Bank Call Interface ($B7xx) --
P:B7B5:b21_inter_bank_call:Inter-bank call dispatcher
P:B7BF:b21_push_da_loop:Push $DA-$E9 to stack
P:B7D5:b21_execute_call:Execute inter-bank call
P:B7EC:b21_pop_da_loop:Pop $DA-$E9 from stack
P:B7FB:b21_call_fixed_05_6f:Call fixed bank routine ($05 6F)

# -- Dialog/Conversation System ($B8xx-$BAxx) --
P:B810:b21_read_dialog_index:Read dialog index
P:B822:b21_dialog_type_01:Dialog type 01 handler
P:B825:b21_set_type_01:Set dialog type to 01
P:B829:b21_dialog_type_03:Dialog type 03 handler
P:B830:b21_dialog_type_02:Dialog type 02 handler
P:B833:b21_set_type_02:Set dialog type to 02
P:B835:b21_store_type:Store dialog type to $07C5
P:B83D:b21_main_dialog_loop:Main dialog processing loop
P:B84E:b21_dialog_flow_00:Dialog flow handler 00
P:B862:b21_dialog_flow_01:Dialog flow handler 01
P:B86F:b21_dialog_flow_02:Dialog flow handler 02
P:B87D:b21_dialog_flow_03:Dialog flow handler 03
P:B890:b21_use_slot_00:Use slot 00
P:B8A8:b21_check_slot_09:Check slot >= 09
P:B8B6:b21_check_party_valid:Check party slot valid
P:B8C0:b21_party_invalid:Party slot invalid handler
P:B8C6:b21_retry_or_exit:Retry or exit dialog

# -- Script Helper Routines ($BAxx-$BFxx) --
P:BA3E:b21_unknown_ba3e:Unknown routine at $BA3E
P:BA55:b21_unknown_ba55:Unknown routine at $BA55
P:BA5D:b21_unknown_ba5d:Unknown routine at $BA5D
P:BACD:b21_unknown_bacd:Unknown routine at $BACD
P:BAEF:b21_unknown_baef:Unknown routine at $BAEF
P:BEBC:b21_call_a6b7:Call $A6B7
P:BECC:b21_call_b4ee_a47c:Call $B4EE then $A47C
P:BED2:b21_clear_0553_high:Clear high bit of $0553
P:BEF6:b21_call_b833:Call $B833
P:BEF9:b21_call_d218:Call $D218
P:BF06:b21_find_slot_50:Find slot via $50 + B7B5
P:BF0E:b21_check_9ce5:Check $9CE5 condition
P:BF1B:b21_call_bf4f:Call $BF4F
P:BF2D:b21_call_a84e:Call $A84E
P:BF36:b21_branch_bf36:Script branch at $BF36
P:BF48:b21_call_a6ff:Call $A6FF
P:BF4E:b21_return_bf4e:Return
P:BF4F:b21_setup_fe_ff:Setup $FE/$FF to $00
P:BF64:b21_scan_npc_loop:Scan NPC data loop
P:BF8A:b21_use_0a_value:Use value $0A
P:BF8E:b21_read_npc_data:Read NPC data at ($DA),Y
P:BF93:b21_store_fd:Store result to $FD
P:BFA4:b21_read_banked_byte:Read byte via banked access

# -- RAM Variables Used by Bank 21 --
G:61DB:b21_party_list:Party member list (128 bytes, $FF = end)
G:625B:b21_party_count_1:Party count variable 1
G:625C:b21_party_count_2:Party count variable 2
G:627B:b21_game_flags:Game event flags array
G:628C:b21_counter_1:Event counter 1
G:628D:b21_counter_2:Event counter 2
G:628F:b21_map_flags:Map event flags
G:62A4:b21_npc_state:NPC state variable
G:62E7:b21_party_flags:Party member flags (3 bytes)
G:62ED:b21_dialog_timer:Dialog timer (set to $28)
G:6BDE:b21_special_flag:Special event flag (bit 7)
G:07BD:b21_name_buffer:Name buffer (8 bytes)
G:07C4:b21_name_length:Name length
G:07C5:b21_dialog_type:Current dialog type (1-3)

# ==============================================================================
# BANK 27 ($8000-$BFFF) - Portal/Warp System and Screen Effects
# ==============================================================================

# -- Jump Table at Entry --
# $8000-$801E: Jump table to portal handlers

# -- Portal/Warp Lookup ($80xx) --
P:801F:b27_portal_entry:Portal/warp entry point
P:802E:b27_portal_not_found:Portal not found return (CLC)
P:8030:b27_portal_found:Portal found - load destination
P:8037:b27_search_special:Search for special warp (map $43)
P:8055:b27_next_special:Next special warp entry
P:805C:b27_load_dest_data:Load destination map/coords
P:8079:b27_check_map_38:Check if map $38 (special case)
P:8082:b27_call_c5c5:Call C5C5 for map transition
P:8097:b27_search_portal_list:Search portal list at $05A0
P:8099:b27_portal_loop:Portal search loop
P:80AF:b27_next_portal:Next portal entry (add 7)
P:80B8:b27_portal_search_fail:Portal search failed (CLC)
P:80BA:b27_check_map_43_range:Check map $43 range $07-$09
P:80CA:b27_return_sec:Return with SEC (success)
P:80CC:b27_check_map_11:Check for map $11:$00
P:80DE:b27_return_clc:Return with CLC (fail)
P:80E0:b27_setup_portal_table:Setup portal table
P:8101:b27_check_map_2c:Check for map $2C
P:810C:b27_portal_setup_return:Portal setup return
P:810D:b27_init_portal_data:Initialize portal data from $822D

# -- Portal Data Copy ($81xx) --
P:8119:b27_copy_loop_start:Portal data copy loop start
P:8120:b27_copy_second_half:Copy second half of portal data
P:8127:b27_inc_pointer:Increment pointer by $0A
P:8135:b27_copy_y02:Copy from offset Y+2
P:8142:b27_copy_y07:Copy from offset Y+7
P:814F:b27_copy_2bytes:Copy 2 bytes to $05A0,X
P:815D:b27_copy_dest_data:Copy destination data
P:8170:b27_check_map_38_2:Check map $38 destination
P:817A:b27_check_map_43_2:Check map $43 destination
P:8186:b27_default_copy:Default destination copy
P:8188:b27_store_5bytes:Store 5 bytes destination
P:81BC:b27_finish_entry:Finish portal entry
P:81C8:b27_infinite_loop:Infinite loop (error?)
P:81CB:b27_map_45_adjust:Map $45 destination adjustment
P:81D9:b27_return_05:Return value $05
P:81DC:b27_map_45_check2:Map $45 check variant 2
P:81EA:b27_return_04:Return value $04
P:81EC:b27_simple_return:Simple return
P:81ED:b27_map_38_adjust:Map $38 destination adjustment
P:81F3:b27_return_03_or_04:Return $03 or $04
P:81F9:b27_ret_calc:Return from calculation
P:81FA:b27_map_43_adjust:Map $43 destination adjustment
P:8206:b27_adjust_return:Adjustment return
P:8207:b27_check_match:Check portal match
P:821E:b27_read_byte:Read byte and compare
P:8220:b27_compare_64:Compare with $64
P:8225:b27_no_match:No match (CLC)
P:8227:b27_end_of_list:End of portal list ($FF)

# -- Screen Transition Effect Entry ($A0FF-$A1xx) --
P:A0FF:b27_screen_effect_entry:Screen transition effect entry
P:A11D:b27_setup_scroll_effect:Setup scroll effect
P:A127:b27_run_outro_effect:Run outro/exit effect
P:A137:b27_scroll_intro_loop:Scroll intro effect loop
P:A154:b27_adjust_scroll_amt:Adjust scroll amount
P:A15F:b27_store_scroll_53:Store scroll to $53
P:A168:b27_scroll_outro_loop:Scroll outro effect loop
P:A18F:b27_use_53_value:Use $53 value for scroll
P:A194:b27_ppu_scroll_render:PPU scroll rendering routine
P:A19E:b27_scroll_line_loop:Scroll line rendering loop
P:A1C4:b27_xor_effect:XOR visual effect
P:A1C8:b27_xor_effect_2:XOR effect part 2
P:A1D3:b27_delay_loop:Short delay loop
P:A1E5:b27_reset_xy:Reset X/Y for next frame
P:A203:b27_init_outro_data:Initialize outro data
P:A219:b27_copy_a479:Copy from $A479 table
P:A236:b27_copy_reverse:Copy in reverse order
P:A248:b27_copy_a494:Copy from $A494 table
P:A265:b27_copy_reverse_2:Copy reverse from $A494
P:A283:b27_fill_91:Fill buffer with $91
P:A28B:b27_fill_91_2:Fill second section
P:A295:b27_fill_91_3:Fill third section
P:A29E:b27_setup_intro_data:Setup intro scroll data
P:A2B4:b27_fill_scroll_buf:Fill scroll buffer
P:A2CA:b27_fill_ppu_ctrl:Fill PPU control buffer
P:A2D3:b27_wait_vblank:Wait for VBlank
P:A2D9:b27_set_flag_08:Set flag $08 in $1F

# -- PPU Operations ($A9xx-$AAxx) --
P:A9B1:b27_ppu_write_setup:PPU write address setup
P:A9C0:b27_write_7800:Write $7800 buffer to PPU
P:A9C9:b27_write_7900:Write $7900 buffer to PPU
P:A9E9:b27_write_attr_loop:Write attribute table loop
P:A9F0:b27_inc_0e_20:Increment $0E by $20
P:A9FB:b27_check_page:Check page boundary
P:AA1D:b27_return_aa1d:Return point
P:AA1E:b27_special_33:Special handler (X=$33)
P:AA26:b27_special_20:Special handler (X=$20)
P:AA28:b27_copy_aa39:Copy from $AA39
P:AA5A:b27_calc_mask:Calculate bit mask
P:AA6C:b27_tile_loop:Tile processing loop
P:AA7B:b27_load_tile_addr:Load tile address
P:AAAD:b27_incx_skip:Increment X if needed
P:AAB4:b27_inner_loop:Inner tile loop
P:AAC0:b27_combine_tiles:Combine tile data

# -- Chapter Handlers ($ABxx) --
P:AB0D:b27_chapter_check_entry:Chapter-specific check entry
P:AB23:b27_chapter_process:Process chapter event
P:AB38:b27_chapter_return:Return from chapter check
P:AB41:b27_chapter_alt:Alternative chapter check
P:AB51:b27_chapter_return_2:Return point 2
P:AB52:b27_check_map_3a:Check for map $3A
P:AB6A:b27_call_c5c5_2:Call C5C5 transition
P:AB74:b27_ab74_return:Return from map check
P:AB8C:b27_check_map_11_2:Check for map $11

# -- Chapter Jump Table ($ACxx) --
P:AAFA:b27_chapter_table_entry:Chapter table entry
P:AB0A:b27_chapter_dispatch:Chapter dispatch via ($0000)

# -- RAM Variables Used by Bank 27 --
G:05A0:b27_portal_list:Portal data list (13 entries x 7 bytes)
G:05FB:b27_portal_end:End of portal list
G:6F60:b27_player_pos_x:Player position X array
G:6F80:b27_player_pos_y:Player position Y array
G:7700:b27_scroll_buffer:Scroll position buffer
G:7782:b27_ppu_ctrl_buf:PPU control buffer
G:7800:b27_nametable_buf1:Nametable buffer 1
G:7900:b27_nametable_buf2:Nametable buffer 2
G:62AA:b27_event_flags:Event/chapter flags

# ==============================================================================
# BANK 28 ($8000-$BFFF) - NPC/Map Object Management System
# ==============================================================================
# This bank handles NPC positioning, map object placement, and compressed
# position data decompression. Heavy use of bit-stream reading at $994E.
# Uses arrays at $6E5E-$7180 for NPC object data.

# -- Bit-Stream Reader Core ($994E-$995B) --
P:994E:b28_read_bits:Read Y bits from compressed data at $DA/$DB
P:9950:b28_bits_setup_x:Setup X register for bit read
P:9954:b28_bits_call_c3ea:Call fixed-bank bit decompression
P:995B:b28_bits_return:Return from bit read

# -- NPC Position Processing ($995C-$99xx) --
P:995C:b28_process_npc_entry:Process NPC entry from compressed data
P:995D:b28_init_dc:Initialize $DC to 0
P:9974:b28_read_bits_5:Read 5 bits for position
P:997B:b28_store_70e0:Store to NPC type array $70E0
P:998F:b28_alt_npc_path:Alternative NPC processing path
P:99B3:b28_read_direction:Read NPC direction from bits
P:99CF:b28_y_equals_01:Y = 1 path
P:99D1:b28_read_position:Read NPC position data

# -- Position Compression/Decompression ($96D2-$97xx) --
P:96D2:b28_check_chapter_4:Check if chapter == 4
P:96DC:b28_call_96fc:Load $00 and call $96FC
P:96E7:b28_save_3a_3b:Save $3A/$3B to $DA/$DB (bitstream pointer)
P:96EF:b28_ret_96ef:Simple return
P:96F0:b28_read_flag_80:Read bits and extract $80 flag
P:96FC:b28_decompress_pos:Main position decompression routine
P:9702:b28_decompress_loop:Decompression loop - read one entry
P:971A:b28_skip_loop:Skip zero entries
P:972B:b28_read_mode_byte:Read mode/type byte
P:974B:b28_read_subtype:Read sub-type value
P:975A:b28_alt_decode:Alternative decode path
P:976F:b28_read_flags:Read flag byte
P:9792:b28_read_final:Read final position byte
P:9798:b28_check_skip:Check if entry should be skipped

# -- NPC Array Management ($98B3-$9C0F) --
P:98B3:b28_init_npc_arrays:Initialize NPC position arrays
P:98B9:b28_init_loop:Init loop - clear $6F60-$7140
P:98D8:b28_read_npc_mode:Read NPC mode byte
P:98EF:b28_setup_indices:Setup array indices 3,4,5
P:98FC:b28_store_npc_entry:Store NPC entry to arrays
P:9901:b28_check_bit_08:Check bit $08 in mode
P:9945:b28_advance_stream:Advance bit stream pointer

# -- NPC Slot Search ($9A37-$9A73) --
P:9A37:b28_find_npc_slot:Find empty NPC slot in $6E5E table
P:9A3B:b28_slot_search_loop:Loop through $6E5E[0-15]
P:9A4F:b28_empty_slot:Found empty slot ($FF)
P:9A54:b28_calculate_index:Calculate final slot index
P:9A61:b28_found_existing:Found existing entry
P:9A6C:b28_check_player:Check if player slot (X=0)
P:9A73:b28_slot_return:Return from slot search

# -- NPC Type Processing ($9A74-$9AFF) --
P:9A74:b28_process_type:Process NPC type value
P:9A89:b28_type_high:Type >= 8 path
P:9AB0:b28_clear_low_nibble:Clear low nibble of $00DF,Y
P:9AB9:b28_type_even:Even type number path
P:9ADE:b28_clear_high_nibble:Clear high nibble
P:9AE7:b28_store_type:Store type to $7040,X
P:9AFB:b28_shift_left_4:Shift left 4 bits

# -- Map Data Loading ($9B00-$9B70) --
P:9B00:b28_load_map_npcs:Load NPCs for current map
P:9B08:b28_setup_e0_e1:Setup pointers $E0/$E1
P:9B26:b28_read_map_ptr:Read map NPC data pointer
P:9B3F:b28_read_count:Read NPC count for map
P:9B47:b28_npc_read_loop:Loop reading NPC entries
P:9B5E:b28_inc_da:Increment $DA pointer
P:9B68:b28_save_ptrs:Save $DA/$DB back to $3A/$3B

# -- Bit Stream Pointer Management ($9B71-$9BD8) --
P:9B71:b28_advance_ptr:Advance bit stream pointer
P:9B90:b28_check_flags:Check flag bits
P:9BA2:b28_add_to_da:Add offset to $DA/$DB
P:9BB0:b28_check_bit_10:Check bit $10 in $03
P:9BB9:b28_bb9_return:Return
P:9BBA:b28_check_bit_08_2:Check bit $08 in $03
P:9BC4:b28_read_and_add:Read byte and add to pointer
P:9BD8:b28_bd8_return:Return

# -- Map Version Check ($9BD9-$9BDE) --
P:9BD9:b28_check_map_version:Check if $62ED >= $78 (post-chapter marker)
P:9BDF:b28_clear_npc_slot:Clear NPC slot data at index X

# -- Clear/Initialize NPC Slot ($9BE1-$9C27) --
P:9BE1:b28_clear_slot_arrays:Clear all arrays for slot X
P:9C0F:b28_clear_slots_6_1f:Clear NPC slots 6-31

# -- Map Event Triggers ($9C28-$9CC0) --
P:9C28:b28_check_event_flags:Check event flags for current map
P:9C2F:b28_event_search_loop:Search event table at $9E61
P:9C65:b28_event_clear:Event found - clear carry
P:9C67:b28_next_event:Next event entry (+4)
P:9C6D:b28_no_event:No event - set carry
P:9C6F:b28_special_event_check:Special event condition check
P:9CBF:b28_clear_carry:Clear carry and return
P:9CC0:b28_cc0_return:Simple return

# -- Map Override Table ($9CC1-$9D0D) --
P:9CC1:b28_check_override_table:Check map override table at $9D0E
P:9CCB:b28_override_loop:Loop through override entries
P:9CF0:b28_set_override_ptr:Set override pointer $DA/$DB
P:9D00:b28_next_override:Next override entry

# -- Map Event/NPC Setup ($9EA6-$A057) --
P:9EA6:b28_setup_map_entry:Main map setup entry point
P:9EB5:b28_check_chapter_version:Check chapter/version for special NPCs
P:9EBE:b28_special_npc_loop:Loop for chapter-specific NPCs
P:9ECC:b28_npc_table_loop:Loop through NPC table at $9F8A
P:9EE5:b28_setup_done:Setup complete
P:9EE6:b28_setup_npc_slot:Setup individual NPC slot
P:9F1C:b28_store_npc_type:Store NPC type data
P:9F44:b28_lookup_tile:Lookup tile at NPC position
P:9F55:b28_next_npc:Move to next NPC entry
P:9F5A:b28_store_type_only:Store type without position
P:9F66:b28_use_player_pos:Use player position for NPC
P:9F76:b28_save_npc_pos:Save NPC position to $054E/$054F

# -- Map Handler Dispatch ($A010-$A057) --
P:A010:b28_handler_lookup:Lookup map-specific handler
P:A012:b28_handler_loop:Loop through handler table at $ABF5
P:A022:b28_next_handler:Next handler entry (+2)
P:A027:b28_handler_done:No handler found
P:A028:b28_handler_found:Handler found - dispatch
P:A035:b28_clear_npc:Clear NPC at slot X
P:A044:b28_check_wagon:Check wagon/party flags
P:A04A:b28_set_npc_pos:Set NPC position (A=X, Y=Y coord)
P:A057:b28_pos_return:Return from position set

# -- Map-Specific Handler Code ($A058-$ABF4) --
# Note: This section contains many map-specific NPC setup routines
# Each map has custom logic for placing NPCs based on story flags
P:A058:b28_map_check_07:Check if player X == 7
P:A068:b28_setup_wagon_npc:Setup wagon/chapter 4 NPC
P:A07E:b28_check_party_flags:Check party member flags
P:A0A0:b28_setup_default_npcs:Setup default NPC slots
P:A0C6:b28_setup_chapter_npcs:Setup chapter-specific NPCs

# -- Various Map Handlers --
P:A177:b28_map_handler_bulk:Bulk NPC setup (slots 0C-14)
P:A17B:b28_bulk_loop:Bulk setup loop

# -- Jump Table for Map Handlers ($AC8A-$AD1C) --
P:AC8A:b28_map_handler_table:Jump table for 60+ map handlers

# -- Map Handler Dispatcher ($AD5F-$AD6D) --
P:AD5F:b28_dispatch_handler:Dispatch to map handler via table
P:AD61:b28_load_handler_addr:Load handler address from $BF4B table
P:AD6B:b28_jump_indirect:JMP ($0000) to handler

# -- Map Condition Table ($AD32-$AD5A) --
P:AD32:b28_check_conditions:Check map conditions table at $AD5A
P:AD34:b28_condition_loop:Loop through conditions
P:AD4C:b28_condition_match:Condition matched - clear NPC
P:AD52:b28_next_condition:Next condition (+4)
P:AD59:b28_condition_done:Done checking conditions

# -- NPC Tile Lookup ($AD1E-$AD31) --
P:AD1E:b28_get_npc_tile:Get tile ID at NPC position
P:AD27:b28_call_d3e6:Call tile lookup via bank switch
P:AD2E:b28_store_tile:Store tile to $7146,X

# -- Wagon/Vehicle Escort Code ($B05E-$B0B8) --
P:B05E:b28_wagon_escort:Wagon escort sequence
P:B083:b28_escort_loop_outer:Outer loop - step counter
P:B087:b28_escort_loop_inner:Inner loop - animation frames
P:B0B2:b28_escort_done:Escort sequence complete

# -- Scene/Cutscene Handlers ($B0FC-$BD95) --
P:B0FC:b28_cutscene_setup:Cutscene initialization
P:B11D:b28_load_scene_data:Load scene-specific data
P:BCEF:b28_find_character:Find character in party
P:BCFF:b28_setup_display:Setup display for scene
P:BD54:b28_save_sprites:Save sprite data to $7F00
P:BD67:b28_restore_sprites:Restore sprite data from $7F00
P:BD75:b28_restore_partial:Restore partial sprite data
P:BD83:b28_save_partial:Save partial sprite data

# -- Helper Functions ($BED3-$BF46) --
P:BED3:b28_helper_0d:Helper - BRK $0D
P:BEF2:b28_shift_delay:Shift and delay helper
P:BEFE:b28_frame_delay:Frame delay with $0509
P:BF12:b28_set_npc_mode:Set NPC mode to $8F
P:BF14:b28_set_npc_mode_x:Set NPC mode with X index
P:BF16:b28_store_mode:Store mode to $0530-$0533
P:BF24:b28_bf24_return:Return
P:BF25:b28_set_position:Set NPC position (A=X, Y=Y) at slot X
P:BF33:b28_hide_npc_80:Hide NPC (set position to $80)
P:BF37:b28_hide_npc_81:Hide NPC (set position to $81)
P:BF39:b28_store_hidden:Store hidden position value
P:BF46:b28_brk_07_6f:BRK $07, $6F, $43 - common helper

# -- Map Handler Jump Table Data ($BF4B-$BFAF) --
P:BF4B:b28_handler_ptr_table:Pointer table for map handlers (low/high bytes)

# -- RAM Variables Used by Bank 28 --
G:6E5E:b28_npc_type_table:NPC type table (16 entries)
G:6F60:b28_npc_x_pos:NPC X position array (32 entries)
G:6F80:b28_npc_y_pos:NPC Y position array (32 entries)
G:6FA0:b28_npc_x_target:NPC X target position array
G:6FC0:b28_npc_y_target:NPC Y target position array
G:6FE0:b28_npc_slot_data:NPC slot data array
G:7000:b28_npc_direction:NPC direction array (32 entries)
G:7020:b28_npc_state:NPC state array
G:7040:b28_npc_type_ext:NPC extended type data
G:7060:b28_npc_ptr_hi:NPC data pointer high
G:7080:b28_npc_ptr_lo:NPC data pointer low
G:70A0:b28_npc_anim_frame:NPC animation frame
G:70C0:b28_npc_timer:NPC timer/counter
G:70E0:b28_npc_flags:NPC flags array
G:7100:b28_npc_sprite:NPC sprite index
G:7120:b28_npc_palette:NPC palette index
G:7140:b28_npc_extra:NPC extra data
G:7146:b28_npc_tile_id:NPC tile ID at position
G:7160:b28_npc_reserved:NPC reserved data
G:7180:b28_npc_user:NPC user-defined data

# -- Zero Page Variables Used by Bank 28 --
G:00DA:b28_bitstream_lo:Bit stream pointer low byte
G:00DB:b28_bitstream_hi:Bit stream pointer high byte
G:00DC:b28_temp_dc:Temporary variable
G:00DD:b28_temp_dd:Temporary variable
G:00DF:b28_type_packed:Packed type data (nibbles)
G:00E0:b28_ptr_e0:Pointer low
G:00E1:b28_ptr_e1:Pointer high
G:003A:b28_saved_ptr_lo:Saved pointer low
G:003B:b28_saved_ptr_hi:Saved pointer high
G:0063:b28_map_num:Current map number
G:0064:b28_submap_num:Current submap number
G:0067:b28_bit_offset:Bit offset in stream

# -- Work RAM Variables --
G:0515:b28_special_flag:Special NPC flag
G:0530:b28_event_mode:Event mode register
G:0531:b28_event_slot:Event slot index
G:0534:b28_event_param:Event parameter
G:054E:b28_last_x:Last NPC X position
G:054F:b28_last_y:Last NPC Y position
G:0598:b28_last_submap:Last submap number
G:62ED:b28_chapter_marker:Chapter progress marker

# ==============================================================================
# PRG ROM - Bank 08: Map Tile Data and Encounter System ($8000-$BFFF when loaded)
# ==============================================================================
# Bank 08 handles map tile data, encounter tables, and location processing.
# Uses arrays at $6F20, $6F40, $7600 for tile data.
# Heavily data-driven with code sections at $80xx-$8Axx and $AFxx-$B7xx.

# -- Bank 08 Array Initialization ($803C-$8054) --
P:803C:b08_init_arrays:Initialize tile/encounter arrays
P:8040:b08_init_loop1:Clear $6F20, $6F40, $7600 arrays (32 entries)
P:804E:b08_init_loop2:Clear $761F+ array (160 entries)

# -- Bank 08 Pointer Calculation ($8055-$80B2) --
P:8055:b08_calc_pointer:Calculate data pointer from $09 and $28
P:806A:b08_store_ptr:Store calculated pointer to $00/$01
P:8072:b08_shift_loop:16-bit shift left 5 times
P:8082:b08_read_params:Read encounter parameters from ($0E)
P:8099:b08_check_encounter_type:Check encounter type ($0A/$0B)
P:80AB:b08_check_flag:Check $6286 flag bit 4
P:80B3:b08_table_80b3:Data table - pointer bases

# -- Bank 08 Secondary Pointer ($80B7-$80C1) --
P:80B7:b08_load_ptr_80c2:Load pointer from $80C2/$80C3
P:80C2:b08_table_80c2:Data table - secondary pointer

# -- Bank 08 Read Encounter Data ($80C4-$80D4) --
P:80C4:b08_read_encounter_data:Read 3-byte encounter data to $0A/$0B/$0C

# -- Bank 08 Process Encounter ($80D5-$8187) --
P:80D5:b08_process_encounter:Main encounter/tile data processor
P:80E7:b08_mode_0_setup:Mode 0 path - setup for tile processing
P:80F4:b08_load_data_ptr:Load data pointer from $8235/$8236
P:8108:b08_extract_bits:Extract bits from tile data
P:8114:b08_store_mode_flag:Store mode flag to $76
P:812F:b08_handle_type_0f:Handle special type $0F
P:8132:b08_mode_1_setup:Mode 1 path - alternate tile processing
P:814A:b08_shift_and_lookup:Shift pointer and lookup data
P:815A:b08_indexed_lookup:Indexed data lookup
P:8171:b08_calc_offset:Calculate 3-byte offset (A * 3)

# -- Bank 08 Monster Group Processing ($8187-$81C3) --
P:8187:b08_process_monster_groups:Process 3 monster types loop
P:8193:b08_sign_extend:Sign extend and shift left 4
P:81B4:b08_store_monster_ptr:Store monster pointer to $0102-$0107
P:81C3:b08_jump_to_rotation:Jump to monster rotation routine

# -- Bank 08 Special Type Handlers ($81C6-$8224) --
P:81C6:b08_handle_type_0f_full:Type $0F - load 8 bytes to $0100
P:81DF:b08_copy_8_bytes:Copy 8 bytes from ($00) to $0100
P:81E8:b08_handle_type_0e:Type $0E - sequential monster setup
P:8213:b08_increment_ptr_loop:Increment monster pointers by $10
P:8225:b08_table_8225:Data table - type handler pointers
P:8229:b08_table_8229:Data table - mode lookup (4 entries)
P:8235:b08_table_8235:Data table - base pointer for tile data
P:8237:b08_table_8237:Data table - secondary lookup

# -- Bank 08 Tile Index Processing ($823D-$833E) --
P:823D:b08_process_tile_index:Process tile index with lookup
P:8254:b08_tile_loop_entry:Entry point for tile loop
P:8256:b08_tile_loop:Main tile processing loop
P:8264:b08_search_77xx:Search $7700 array for match
P:828D:b08_no_match:No match found - increment $18
P:8291:b08_found_or_new:Handle found/new tile entry
P:82AD:b08_skip_tile:Skip to next tile
P:82B0:b08_mode_1_store:Mode 1 specific storage
P:82C2:b08_rotate_bits:Bit rotation for tile attributes
P:82EC:b08_store_rotated:Store rotated result
P:831F:b08_add_to_77xx:Add entry to $7700 array
P:832F:b08_next_tile:Advance to next tile entry
P:833E:b08_table_833e:Data table - tile lookup offset

# -- Bank 08 Map Index Processing ($8340-$839E) --
P:8340:b08_process_map_index:Process map index from $16
P:8362:b08_setup_ppu_addr:Setup PPU address for rendering
P:8378:b08_calc_ppu_offset:Calculate PPU offset (*16)
P:8389:b08_ppu_base_table:PPU base address table (lo/hi)
P:838D:b08_write_ppu_addr:Write PPU address to $2006
P:839F:b08_buffer_ppu_addr:Buffer PPU address to $0300

# -- Bank 08 Tile Rendering ($83BD-$8405) --
P:83BD:b08_render_tiles:Render tiles from $0100 array
P:83D9:b08_bank_select:Bank select for tile rendering
P:83DC:b08_render_call:Call render subroutines
P:83F4:b08_write_ppu_data:Write 16 bytes to PPU $2007
P:83FA:b08_write_loop:Write loop - 16 bytes
P:8406:b08_buffer_tiles:Buffer tiles to $0300 for deferred PPU

# -- Bank 08 Tile Lookup ($8433-$8467) --
P:8433:b08_lookup_tile_data:Lookup tile data from table
P:8450:b08_tile_lookup_ptr:Pointer for tile lookup ($76C0)
P:8452:b08_store_tile_result:Store tile result to $6F20/$6F40

# -- Bank 08 Stack Restore ($8468-$8472) --
P:8468:b08_restore_stack:Restore 16 bytes from stack to $00-$0F

# -- Bank 08 Main Tile Process ($8473-$84BC) --
P:8473:b08_main_tile_process:Main tile processing entry
P:8476:b08_check_tile_type:Check tile type (AND #$07)
P:847E:b08_call_tile_handlers:Call tile handler chain
P:84A6:b08_dec_counter:Decrement $6E5E counter
P:84AB:b08_render_chain:Call render chain
P:84B1:b08_advance_ptr:Advance pointer by 2

# -- Bank 08 Tile Process Wrapper ($84BD-$84E2) --
P:84BD:b08_tile_process_wrapper:Store $16 and call main processor
P:84C2:b08_setup_mode_1:Setup mode 1 processing
P:84CA:b08_save_zp:Save zero page to stack
P:84DC:b08_init_6e5e:Initialize $6E5E to $FF (32 entries)

# -- Bank 08 BRK Interpreter ($84E3-$8538) --
P:84E3:b08_brk_interpreter:BRK-based bytecode interpreter
P:84EF:b08_init_encounter:Initialize encounter arrays
P:8503:b08_setup_ppu:Setup PPU for encounter
P:850E:b08_tile_loop_20:Process 32 tiles (0-$1F)
P:8523:b08_tile_loop_30:Process tiles $20-$2F
P:852F:b08_finalize:Finalize and cleanup

# -- Bank 08 Extended Tile ($853E-$859A) --
P:853E:b08_extended_tile:Extended tile processing
P:8562:b08_shift_for_quad:Shift for quadrant calculation
P:856C:b08_get_quadrant:Get quadrant from shifted value
P:8573:b08_load_quadrant_data:Load quadrant data from $8AAF
P:8588:b08_load_second_quad:Load second quadrant entry

# -- Bank 08 Zone Processing ($859B-$85D2) --
P:859B:b08_process_zone:Process zone/region value
P:85A6:b08_check_zone_range:Check zone range ($48-$4F)
P:85BA:b08_store_zone:Store zone to $0E
P:85CD:b08_set_mode_flag:Set $7A mode flag

# -- Bank 08 Dungeon Setup ($85D3-$8667) --
P:85D3:b08_dungeon_setup:Setup for dungeon encounter
P:85E2:b08_dungeon_loop:Dungeon tile processing loop
P:8617:b08_encounter_table_lookup:Lookup encounter table

# -- Bank 08 Encounter Rate ($8668-$8702) --
P:8668:b08_calc_encounter_rate:Calculate encounter rate
P:8680:b08_apply_modifiers:Apply encounter rate modifiers
P:8703:b08_encounter_table:Encounter rate table data

# -- Bank 08 Position Calculation ($8773-$87FF) --
P:8773:b08_calc_position:Calculate position from coordinates
P:8796:b08_position_table:Position lookup table
P:8800:b08_coord_lookup:Coordinate lookup table

# -- Bank 08 Movement Direction ($880E-$88FD) --
P:880E:b08_movement_dir:Determine movement direction
P:882A:b08_cardinal_check:Check cardinal direction
P:88D0:b08_diagonal_check:Check diagonal movement
P:88ED:b08_calc_distance:Calculate distance to target
P:88FE:b08_find_target:Find target position from tile type

# -- Bank 08 Tile Type Lookup ($893D-$8980) --
P:893D:b08_adjust_for_dir:Adjust position for direction
P:8957:b08_get_tile_at_pos:Get tile type at position
P:896F:b08_search_tile_type:Search for specific tile type
P:897E:b08_return_index:Return found index

# -- Bank 08 Monster Rotation ($8981-$89C8) --
P:8981:b08_monster_rotation:Rotate monster group order
P:8990:b08_rotation_loop:Rotation loop - shift $0100-$0107

# -- Bank 08 Tile Transpose ($89C9-$8A29) --
P:89C9:b08_tile_transpose:Transpose tile data
P:89D8:b08_transpose_loop:Transpose outer loop
P:89DC:b08_transpose_inner:Transpose inner loop
P:8A00:b08_extract_bits_horiz:Extract horizontal bits
P:8A15:b08_extract_bits_vert:Extract vertical bits

# -- Bank 08 Special Tile Handling ($8A2A-$8A91) --
P:8A2A:b08_special_tile:Handle special tile types
P:8A3F:b08_normal_tile:Normal tile path
P:8A58:b08_return_result:Return tile result
P:8A85:b08_post_process:Post-process tile data

# -- Bank 08 Data Tables ($8A92-$8ABF) --
P:8A92:b08_table_8a92:Tile type data table
P:8AA2:b08_table_8aa2:Quadrant lookup table
P:8AAF:b08_table_8aaf:Quadrant data table (4 bytes each)

# -- Bank 08 Location Data System ($AF00-$B036) --
P:AED5:b08_location_entry:Location data entry point
P:AEE8:b08_location_loop:Location search loop
P:AF13:b08_store_map_num:Store map number to $63
P:AF32:b08_location_setup:Location setup calls
P:AF40:b08_load_location_data:Load location coordinates
P:AF51:b08_check_special_loc:Check for special locations
P:AF67:b08_check_loc_0e:Check location type $0E
P:AF82:b08_store_loc_params:Store location parameters ($64, $44, $45)
P:AF89:b08_get_loc_terrain:Get location terrain type
P:AF99:b08_check_loc_special:Check special location cases
P:AFBA:b08_loc_3a_handler:Location $3A special handler
P:AFC9:b08_loc_39_handler:Location $39 special handler
P:AFE1:b08_loc_19_handler:Location $19 special handler
P:AFF3:b08_loc_45_handler:Location $45 special handler
P:B00B:b08_loc_0b_handler:Location $0B special handler
P:B01C:b08_loc_2c_handler:Location $2C special handler
P:B036:b08_location_return:Location return

# -- Bank 08 Location Lookup ($B037-$B05B) --
P:B037:b08_lookup_location:Lookup location in table
P:B043:b08_lookup_loop:Location lookup loop
P:B05B:b08_lookup_done:Lookup complete

# -- Bank 08 Location Read ($B05C-$B0AD) --
P:B05C:b08_read_location_byte:Read single byte from location data
P:B06A:b08_brk_loc_search:BRK-based location search
P:B071:b08_loc_search_loop:Location search loop
P:B08D:b08_found_location:Found matching location

# -- Bank 08 Location Processing ($B0AE-$B187) --
P:B0AE:b08_process_location:Process location data
P:B135:b08_calc_encounter:Calculate location encounter rate
P:B145:b08_loc_not_found:Location not found handler

# -- Bank 08 Exit Processing ($B188-$B22D) --
P:B188:b08_exit_handler:Exit/door handler
P:B194:b08_check_door:Check door type
P:B1D0:b08_exit_table:Exit point table

# -- Bank 08 Treasure Processing ($B22E-$B322) --
P:B22E:b08_treasure_handler:Treasure chest handler
P:B27F:b08_item_check:Check item availability
P:B2C2:b08_empty_chest:Empty chest handler

# -- Bank 08 NPC Interaction ($B323-$B439) --
P:B323:b08_npc_interact:NPC interaction handler
P:B397:b08_npc_dialog:NPC dialog trigger
P:B3D9:b08_npc_special:Special NPC handler
P:B425:b08_npc_3a:NPC type $3A handler
P:B43A:b08_npc_19:NPC type $19 handler

# -- Bank 08 Flag Checking ($B48E-$B553) --
P:B48E:b08_compare_flags:Compare flags against saved state
P:B4B9:b08_flag_changed:Handle flag change
P:B4C1:b08_terrain_encounter:Terrain-based encounter modifier
P:B4ED:b08_get_tile_table:Get tile table pointer
P:B51F:b08_count_tiles:Count matching tiles
P:B554:b08_search_tiles:Search for specific tile type

# -- Bank 08 Warp/Teleport ($B5B3-$B5F0) --
P:B5B3:b08_warp_check:Check warp availability
P:B5BF:b08_warp_execute:Execute warp
P:B5E2:b08_check_warp_flag:Check warp flag in $62AA
P:B5F1:b08_return_result:Return warp result

# -- Bank 08 Data Tables ($B5F2-$B7FF) --
P:B5F2:b08_data_tables:Various data tables
P:B671:b08_table_b671:Tile data table pointer
P:B673:b08_table_b673:Secondary table pointer
P:B67D:b08_table_b67d:Tertiary table pointer
P:B7F7:b08_table_b7f7:Location data table pointer

# -- Bank 08 RAM Variables --
G:6F20:b08_tile_data_1:Tile data array 1 (32 entries)
G:6F40:b08_tile_data_2:Tile data array 2 (32 entries)
G:7600:b08_encounter_data:Encounter data array (160 entries)
G:7684:b08_quadrant_flags:Quadrant flags (4 bytes)
G:7700:b08_tile_cache:Tile cache array (256 bytes)

# -- Bank 08 Zero Page Variables --
P:0000:b08_temp_00:Temporary pointer low
P:0001:b08_temp_01:Temporary pointer high
P:0002:b08_temp_02:Secondary temp low
P:0003:b08_temp_03:Secondary temp high
P:0004:b08_counter_04:Counter variable
P:0005:b08_counter_05:Counter high byte
P:0007:b08_mode_flag:Mode flag (0 or non-zero)
P:0008:b08_shift_count:Shift counter
P:0009:b08_mode_select:Mode selector (0 or 1)
P:000A:b08_param_a:Parameter A - tile/encounter data
P:000B:b08_param_b:Parameter B
P:000C:b08_param_c:Parameter C
P:000D:b08_buffer_mode:Buffer mode (0=direct, 1=deferred)
P:000E:b08_ptr_0e:Data pointer low
P:000F:b08_ptr_0f:Data pointer high
P:0016:b08_tile_index:Current tile index
P:0018:b08_tile_id_base:Tile ID base value
P:0019:b08_ppu_addr_lo:PPU address low
P:001A:b08_ppu_addr_hi:PPU address high
P:0072:b08_calc_lo:Calculation temp low
P:0073:b08_calc_hi:Calculation temp high
P:0074:b08_rotation_cnt:Rotation count
P:0075:b08_rotation_tmp:Rotation temp
P:0076:b08_mode_76:Mode flag ($76)
P:0079:b08_cache_index:Tile cache index
P:007A:b08_transpose_flag:Transpose flag
P:00DA:b08_loc_ptr_lo:Location pointer low
P:00DB:b08_loc_ptr_hi:Location pointer high
P:00DC:b08_loc_temp_dc:Location temp DC
P:00DD:b08_loc_temp_dd:Location temp DD
P:00DE:b08_encounter_mod_lo:Encounter modifier low
P:00DF:b08_encounter_mod_hi:Encounter modifier high
P:00E4:b08_last_map:Last map number
P:00E5:b08_last_submap:Last submap number
P:00E6:b08_last_x:Last X coordinate
P:00E7:b08_last_y:Last Y coordinate
P:00E9:b08_save_reg:Saved register temp



